{"title":"Chart: Cuts to officer numbers still being felt in some forces","markdown":{"yaml":{"title":"Chart: Cuts to officer numbers still being felt in some forces","author":"Matt Ashby","date":"2022-07-27","slug":"police-uplift-2022","categories":["Crime and justice chart of the week"],"tags":["police","trends","criminal justice"]},"headingText":"custom packages not loaded by helpers.R","containsRefs":false,"markdown":"\n\n\n```{r set knitr options, include=FALSE}\nknitr::opts_chunk$set(cache = TRUE, include=FALSE)\n```\n\n```{r set chart parameters}\nchart_details <- list(\n\tid = \"police-uplift-2022\",\n\ttitle = \"Cuts to officer numbers still being felt in some forces\",\n\tsubtitle = \"The government plans to reverse their previous police cuts by recruiting 20,000 extra police officers between 2019 and 2023. But the funding for those officers isn't spread evenly, meaning 18 forces now have more officers than in 2010 while eight forces still have at least 10% fewer officers than 12 years ago.\",\n  title2 = \"Most police forces have cut staff from support roles\",\n  subtitle2 = \"Police staff do a variety of important roles in policing, from answering emergency calls and collecting forensic evidence to analysing intelligence information and managing detainees in custody. When forced to make cuts in the 2010s, most forces chose to reduce the number of support staff to maintain the number of police officers. The legacy of those cuts is still being felt: only eight forces have as many police staff now as in 2010.\",\n\tsource_url = \"https://www.gov.uk/government/statistics/police-workforce-open-data-tables\",\n\tsource_title = \"Home Office, 2022\"\n)\n```\n\n```{r load packages and helper, cache=FALSE}\nlibrary(\"ggrepel\")\nlibrary(\"lubridate\")\nlibrary(\"readODS\")\n\n# load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n```\n\n```{r get and tidy data}\nif (!file.exists(paste0(chart_details$id, \"-data.csv.gz\"))) {\n  \n  # Get new data from the Home Office website\n  new_data_file <- tempfile(fileext = \".ods\")\n  GET(\"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1093587/open-data-table-police-workforce-270722.ods\", write_disk(new_data_file))\n  tidy_data <- new_data_file %>% \n    read_ods(sheet = \"Data\", na = \"N/A\") %>% \n    as_tibble() %>% \n    janitor::clean_names() %>% \n    filter(!is.na(geo_code)) %>% \n    rename(date = as_at_31_march) %>% \n    mutate(\n      date = ym(str_glue(\"{date}-03\")),\n      worker_type = str_to_lower(worker_type)\n    ) %>% \n    replace_na(list(total_fte = 0))\n  \n  # save tidy data\n  write_csv(tidy_data, paste0(chart_details$id, \"-data.csv.gz\"))\t\n  \n} else {\n  \n  # load tidy data\n  tidy_data <- read_csv(paste0(chart_details$id, \"-data.csv.gz\"))\n  \n}\n```\n\n\n```{r prepare plot data}\ncommon_data <- tidy_data %>% \n\tmutate(\n\t\tforce_name = str_replace(force_name, \"^North \", \"N \"),\n\t\tforce_name = str_replace(force_name, \"^South \", \"S \"),\n\t\tforce_name = str_replace(force_name, \"^West \", \"W \"),\n\t\tforce_name = str_replace(force_name, \" Yorkshire$\", \" Yorks\"),\n\t\tforce_name = recode(force_name, \n  \t\t\"Avon & Somerset\" = \"Avon & Som\",\n\t\t\t\"Bedfordshire\" = \"Beds\",\n\t\t\t\"Cambridgeshire\" = \"Cambs\",\n\t\t\t\"Derbyshire\" = \"Derbys\",\n\t\t\t\"Devon & Cornwall\" = \"Dvn & Corn\",\n\t\t\t\"Gloucestershire\" = \"Gloucs\",\n\t\t\t\"Greater Manchester\" = \"G Mnchstr\",\n\t\t\t\"Hampshire\" = \"Hants\",\n\t  \t\"Hertfordshire\" = \"Herts\",\n\t\t\t\"Lancashire\" = \"Lancs\",\n\t\t\t\"Leicestershire\" = \"Leics\",\n\t\t\t\"Lincolnshire\" = \"Lincs\",\n  \t\t\"Metropolitan Police\" = \"Met Police\",\n  \t\t\"Northamptonshire\" = \"Northants\",\n\t\t\t\"Nottinghamshire\" = \"Notts\",\n\t\t\t\"Staffordshire\" = \"Staffs\",\n\t\t\t\"Thames Valley\" = \"Thames V\",\n\t\t\t\"Warwickshire\" = \"Warwicks\",\n\t\t\t\"W Midlands\" = \"W Mids\"\n  \t)\n\t)\n\nchart_data <- common_data %>% \n\tfilter(\n\t  date >= ym(\"2010-03\"), \n\t  force_name != \"London, City of\",\n\t  worker_type == \"police officer\"\n\t) %>% \n  count(date, force_name, wt = total_fte, name = \"officers\") %>% \n\tgroup_by(force_name) %>% \n\tmutate(\n\t\tperc_change = (officers - first(officers)) / first(officers),\n\t\tdiff_perc_change = perc_change - lag(perc_change),\n\t\ttrajectory = sum(nth(diff_perc_change, -3), nth(diff_perc_change, -2), \n\t\t\t\t\t\t\t\t\t\t nth(diff_perc_change, -1)),\n\t\tforce_group = fct_case_when(\n\t\t  last(perc_change) > 0 ~ \"more\\nofficers now\",\n\t\t  last(perc_change) > -0.05 ~ \"0–5% fewer\\nofficers now\",\n\t\t\tTRUE ~ \">5% fewer\\nofficers now\"\n\t\t),\n\t\tlast = if_else(date == last(date), TRUE, NA),\n\t\tlabel = if_else(\n\t\t  last == TRUE, \n\t\t  scales::number(\n\t\t    perc_change, \n\t\t    accuracy = 0.1, \n\t\t    scale = 100, \n\t\t    suffix = \"%\", \n\t\t    style_negative = \"minus\", \n\t\t    style_positive = \"plus\"\n\t\t  ), \n\t\t  NA_character_\n\t\t),\n\t\tlabel_y = if_else(last(perc_change) > 0, last(perc_change), 0)\n\t) %>% \n\tungroup() %>% \n\t# calculate average change for each year for England and Wales\n\tgroup_by(date) %>% \n\tmutate(ew_officers = sum(officers)) %>% \n\tungroup() %>% \n\tmutate(\n\t\tew_perc_change = (ew_officers - first(ew_officers)) / first(ew_officers)\n\t) %>% \n\tselect(-ew_officers) %>% \n\tungroup()\n\nforces_in_order <- chart_data %>% \n\tfilter(date == last(date)) %>% \n\tarrange(desc(perc_change)) %>% \n\tpull(\"force_name\")\n\nchart_data <- chart_data %>% \n\tmutate(force_name = fct_relevel(force_name, forces_in_order))\n```\n\n```{r build plot}\nchart <- chart_data %>% \n\tggplot(aes(\n\t  x = date, \n\t  y = perc_change, \n\t  ymin = 0, \n\t  ymax = perc_change, \n\t  colour = force_group, \n\t  fill = force_group\n\t)) + \n\tgeom_ribbon(colour = NA, alpha = 0.1) +\n\tgeom_line(aes(y = ew_perc_change, \n\t\t\t\t\t\t\t\tlinetype = \"England & Wales\\naverage change\"), \n\t\t\t\t\t\tcolour = \"grey50\") + \n\tgeom_line(size = 0.75) + \n\tgeom_point(aes(shape = last), na.rm = TRUE, show.legend = FALSE) +\n\tgeom_text(\n\t  aes(y = label_y, label = label), \n\t  size = elements$label_text_size * (7 / 9), \n\t  hjust = \"right\", \n\t  vjust = 0,\n\t  na.rm = TRUE, \n\t  show.legend = FALSE\n\t) + \n\tscale_x_continuous(breaks = c(2010, 2019), labels = c(\"'10\", \"'19\")) + \n\tscale_y_continuous(\n\t\tlabels = scales::label_percent(accuracy = 1, style_negative = \"minus\", style_positive = \"plus\")\n\t) + \n\tscale_colour_manual(\n\t\taesthetics = c(\"colour\", \"fill\"),\n\t\tvalues = unname(\n\t\t  ucl_colours_list[c(\"Mid Blue\", \"Orange\", \"Bright Red\")]\n\t\t), \n\t\tguide = guide_legend(ncol = 1), \n\t\tname = \"compared to 2010 …\"\n\t) +\n\tscale_linetype_manual(values = \"11\") +\n\tcoord_cartesian(clip = \"off\") +\n\tfacet_wrap(vars(force_name)) +\n  labs(\n    title = chart_details$title,\n    subtitle = chart_details$subtitle,\n    x = NULL,\n    y = \"change in number of police officers relative to 2010\",\n    linetype = NULL\n  ) +\n\ttheme_cjcharts() +\n\ttheme(\n\t\taxis.text = element_text(size = 7),\n\t\tlegend.key.width = unit(18, \"points\"),\n\t\tlegend.text = element_text(margin = margin(t = 4, b = 4)),\n\t\tlegend.title.align = 0,\n\t\tlegend.position = \"right\",\n\t\tlegend.margin = margin(t = 4, r = 0, b = 4, l = 0),\n\t\tlegend.box.margin = margin(),\n\t\tpanel.grid.minor.y = element_blank(),\n\t\tpanel.spacing = unit(0.4, \"lines\"),\n\t\tplot.subtitle = ggtext::element_textbox_simple(margin = margin(t = 6, b = 6)),\n\t\tstrip.text = element_text(size = 8),\n\t\tstrip.background = element_blank()\n\t)\n\n```\n\n`r chart_details$subtitle`\n\n```{r display plot, echo=FALSE, include=TRUE, cache=FALSE, fig.asp=1}\nadd_logo(chart + labs(title = NULL, subtitle = NULL), \n\t\t\t\t chart_details$source_title, chart_details$id)\n```\n\n[larger image](../`r chart_details$id`.png)\n\n```{r build-second-plot}\nchart2_data <- common_data %>% \n\tfilter(\n\t  date >= ym(\"2010-03\"), \n\t  force_name != \"London, City of\",\n\t  worker_type %in% c(\"police staff\", \"police community support officer\", \"designated officer\")\n\t) %>% \n  count(date, force_name, wt = total_fte, name = \"officers\") %>% \n\tgroup_by(force_name) %>% \n\tmutate(\n\t\tperc_change = (officers - first(officers)) / first(officers),\n\t\tdiff_perc_change = perc_change - lag(perc_change),\n\t\ttrajectory = sum(nth(diff_perc_change, -3), nth(diff_perc_change, -2), \n\t\t\t\t\t\t\t\t\t\t nth(diff_perc_change, -1)),\n\t\tforce_group = fct_case_when(\n\t\t  last(perc_change) >= 0 ~ \"more\\nstaff now\",\n\t\t  last(perc_change) > -0.05 ~ \"0–5% fewer\\nstaff now\",\n\t\t\tTRUE ~ \">5% fewer\\nstaff now\"\n\t\t),\n\t\tlast = if_else(date == last(date), TRUE, NA),\n\t\tlabel = if_else(\n\t\t  last == TRUE, \n\t\t  scales::number(\n\t\t    perc_change, \n\t\t    accuracy = 0.1, \n\t\t    scale = 100, \n\t\t    suffix = \"%\", \n\t\t    style_negative = \"minus\", \n\t\t    style_positive = \"plus\"\n\t\t  ), \n\t\t  NA_character_\n\t\t),\n\t\tlabel_y = if_else(last(perc_change) > 0, last(perc_change), 0)\n\t) %>% \n\tungroup() %>% \n\t# calculate average change for each year for England and Wales\n\tgroup_by(date) %>% \n\tmutate(ew_officers = sum(officers)) %>% \n\tungroup() %>% \n\tmutate(\n\t\tew_perc_change = (ew_officers - first(ew_officers)) / first(ew_officers)\n\t) %>% \n\tselect(-ew_officers) %>% \n\tungroup()\n\nforces_in_order2 <- chart2_data %>% \n\tfilter(date == last(date)) %>% \n\tarrange(desc(perc_change)) %>% \n\tpull(\"force_name\")\n\nchart2_data <- chart2_data %>% \n\tmutate(\n\t  force_name = fct_relevel(force_name, forces_in_order2),\n\t  force_name = fct_recode(force_name, \"Lincs§\" = \"Lincs\", \"Cleveland†\" = \"Cleveland\")\n\t)\n\nchart2 <- chart2_data %>% \n\tggplot(aes(\n\t  x = date, \n\t  y = perc_change, \n\t  ymin = 0, \n\t  ymax = perc_change, \n\t  colour = force_group, \n\t  fill = force_group\n\t)) + \n\tgeom_ribbon(colour = NA, alpha = 0.1) +\n\tgeom_line(aes(y = ew_perc_change, \n\t\t\t\t\t\t\t\tlinetype = \"England & Wales\\naverage change\"), \n\t\t\t\t\t\tcolour = \"grey50\") + \n\tgeom_line(size = 0.75) + \n\tgeom_point(aes(shape = last), na.rm = TRUE, show.legend = FALSE) +\n\tgeom_text(\n\t  aes(y = label_y, label = label), \n\t  size = elements$label_text_size * (7 / 9), \n\t  hjust = \"right\", \n\t  vjust = 0,\n\t  na.rm = TRUE, \n\t  show.legend = FALSE\n\t) + \n\tscale_x_continuous(breaks = c(2010, 2019), labels = c(\"'10\", \"'19\")) + \n\tscale_y_continuous(\n\t\tlabels = scales::label_percent(accuracy = 1, style_negative = \"minus\", style_positive = \"plus\")\n\t) + \n\tscale_colour_manual(\n\t\taesthetics = c(\"colour\", \"fill\"),\n\t\tvalues = unname(\n\t\t  ucl_colours_list[c(\"Mid Blue\", \"Orange\", \"Bright Red\")]\n\t\t), \n\t\tguide = guide_legend(ncol = 1), \n\t\tname = \"compared to 2010 …\"\n\t) +\n\tscale_linetype_manual(values = \"11\") +\n\tcoord_cartesian(clip = \"off\") +\n\tfacet_wrap(vars(force_name)) +\n  labs(\n    title = chart_details$title2,\n    subtitle = chart_details$subtitle2,\n    caption = \"\\\\* Includes community support officers and designated officers. † Cleveland outsourced most police staff from 2011 to 2020. § Lincolnshire outsourced most police staff from 2012 to 2022.\",\n    x = NULL,\n    y = \"change in number of police staff* relative to 2010\",\n    linetype = NULL\n  ) +\n\ttheme_cjcharts() +\n\ttheme(\n\t\taxis.text = element_text(size = 7),\n\t\tlegend.key.width = unit(18, \"points\"),\n\t\tlegend.text = element_text(margin = margin(t = 4, b = 4)),\n\t\tlegend.title.align = 0,\n\t\tlegend.position = \"right\",\n\t\tlegend.margin = margin(t = 4, r = 0, b = 4, l = 0),\n\t\tlegend.box.margin = margin(),\n\t\tpanel.grid.minor.y = element_blank(),\n\t\tpanel.spacing = unit(0.4, \"lines\"),\n\t\tplot.caption = ggtext::element_textbox_simple(),\n\t\tplot.caption.position = \"plot\",\n\t\tplot.subtitle = ggtext::element_textbox_simple(margin = margin(t = 6, b = 6)),\n\t\tstrip.text = element_text(size = 8),\n\t\tstrip.background = element_blank()\n\t)\n\n```\n\nThe situation is different for police staff. `r chart_details$subtitle2`\n\n```{r display plot 2, echo=FALSE, include=TRUE, cache=FALSE, fig.asp=1}\nadd_logo(chart2 + labs(title = NULL, subtitle = NULL), \n\t\t\t\t chart_details$source_title, chart_details$id)\n```\n\n[larger image](../`r chart_details$id`-staff.png)\n\n[annotated R code to produce these charts](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export charts, cache=FALSE}\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", width = 600 / 72, height = 600 / 72, units = \"in\", bg = \"white\"\n)\n\nggsave(\n\tfilename = paste0(chart_details$id, \"-staff.png\"), \n\tplot = add_logo(chart2, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", width = 600 / 72, height = 600 / 72, units = \"in\", bg = \"white\"\n)\n```\n\n","srcMarkdownNoYaml":"\n\n\n```{r set knitr options, include=FALSE}\nknitr::opts_chunk$set(cache = TRUE, include=FALSE)\n```\n\n```{r set chart parameters}\nchart_details <- list(\n\tid = \"police-uplift-2022\",\n\ttitle = \"Cuts to officer numbers still being felt in some forces\",\n\tsubtitle = \"The government plans to reverse their previous police cuts by recruiting 20,000 extra police officers between 2019 and 2023. But the funding for those officers isn't spread evenly, meaning 18 forces now have more officers than in 2010 while eight forces still have at least 10% fewer officers than 12 years ago.\",\n  title2 = \"Most police forces have cut staff from support roles\",\n  subtitle2 = \"Police staff do a variety of important roles in policing, from answering emergency calls and collecting forensic evidence to analysing intelligence information and managing detainees in custody. When forced to make cuts in the 2010s, most forces chose to reduce the number of support staff to maintain the number of police officers. The legacy of those cuts is still being felt: only eight forces have as many police staff now as in 2010.\",\n\tsource_url = \"https://www.gov.uk/government/statistics/police-workforce-open-data-tables\",\n\tsource_title = \"Home Office, 2022\"\n)\n```\n\n```{r load packages and helper, cache=FALSE}\n# custom packages not loaded by helpers.R\nlibrary(\"ggrepel\")\nlibrary(\"lubridate\")\nlibrary(\"readODS\")\n\n# load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n```\n\n```{r get and tidy data}\nif (!file.exists(paste0(chart_details$id, \"-data.csv.gz\"))) {\n  \n  # Get new data from the Home Office website\n  new_data_file <- tempfile(fileext = \".ods\")\n  GET(\"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1093587/open-data-table-police-workforce-270722.ods\", write_disk(new_data_file))\n  tidy_data <- new_data_file %>% \n    read_ods(sheet = \"Data\", na = \"N/A\") %>% \n    as_tibble() %>% \n    janitor::clean_names() %>% \n    filter(!is.na(geo_code)) %>% \n    rename(date = as_at_31_march) %>% \n    mutate(\n      date = ym(str_glue(\"{date}-03\")),\n      worker_type = str_to_lower(worker_type)\n    ) %>% \n    replace_na(list(total_fte = 0))\n  \n  # save tidy data\n  write_csv(tidy_data, paste0(chart_details$id, \"-data.csv.gz\"))\t\n  \n} else {\n  \n  # load tidy data\n  tidy_data <- read_csv(paste0(chart_details$id, \"-data.csv.gz\"))\n  \n}\n```\n\n\n```{r prepare plot data}\ncommon_data <- tidy_data %>% \n\tmutate(\n\t\tforce_name = str_replace(force_name, \"^North \", \"N \"),\n\t\tforce_name = str_replace(force_name, \"^South \", \"S \"),\n\t\tforce_name = str_replace(force_name, \"^West \", \"W \"),\n\t\tforce_name = str_replace(force_name, \" Yorkshire$\", \" Yorks\"),\n\t\tforce_name = recode(force_name, \n  \t\t\"Avon & Somerset\" = \"Avon & Som\",\n\t\t\t\"Bedfordshire\" = \"Beds\",\n\t\t\t\"Cambridgeshire\" = \"Cambs\",\n\t\t\t\"Derbyshire\" = \"Derbys\",\n\t\t\t\"Devon & Cornwall\" = \"Dvn & Corn\",\n\t\t\t\"Gloucestershire\" = \"Gloucs\",\n\t\t\t\"Greater Manchester\" = \"G Mnchstr\",\n\t\t\t\"Hampshire\" = \"Hants\",\n\t  \t\"Hertfordshire\" = \"Herts\",\n\t\t\t\"Lancashire\" = \"Lancs\",\n\t\t\t\"Leicestershire\" = \"Leics\",\n\t\t\t\"Lincolnshire\" = \"Lincs\",\n  \t\t\"Metropolitan Police\" = \"Met Police\",\n  \t\t\"Northamptonshire\" = \"Northants\",\n\t\t\t\"Nottinghamshire\" = \"Notts\",\n\t\t\t\"Staffordshire\" = \"Staffs\",\n\t\t\t\"Thames Valley\" = \"Thames V\",\n\t\t\t\"Warwickshire\" = \"Warwicks\",\n\t\t\t\"W Midlands\" = \"W Mids\"\n  \t)\n\t)\n\nchart_data <- common_data %>% \n\tfilter(\n\t  date >= ym(\"2010-03\"), \n\t  force_name != \"London, City of\",\n\t  worker_type == \"police officer\"\n\t) %>% \n  count(date, force_name, wt = total_fte, name = \"officers\") %>% \n\tgroup_by(force_name) %>% \n\tmutate(\n\t\tperc_change = (officers - first(officers)) / first(officers),\n\t\tdiff_perc_change = perc_change - lag(perc_change),\n\t\ttrajectory = sum(nth(diff_perc_change, -3), nth(diff_perc_change, -2), \n\t\t\t\t\t\t\t\t\t\t nth(diff_perc_change, -1)),\n\t\tforce_group = fct_case_when(\n\t\t  last(perc_change) > 0 ~ \"more\\nofficers now\",\n\t\t  last(perc_change) > -0.05 ~ \"0–5% fewer\\nofficers now\",\n\t\t\tTRUE ~ \">5% fewer\\nofficers now\"\n\t\t),\n\t\tlast = if_else(date == last(date), TRUE, NA),\n\t\tlabel = if_else(\n\t\t  last == TRUE, \n\t\t  scales::number(\n\t\t    perc_change, \n\t\t    accuracy = 0.1, \n\t\t    scale = 100, \n\t\t    suffix = \"%\", \n\t\t    style_negative = \"minus\", \n\t\t    style_positive = \"plus\"\n\t\t  ), \n\t\t  NA_character_\n\t\t),\n\t\tlabel_y = if_else(last(perc_change) > 0, last(perc_change), 0)\n\t) %>% \n\tungroup() %>% \n\t# calculate average change for each year for England and Wales\n\tgroup_by(date) %>% \n\tmutate(ew_officers = sum(officers)) %>% \n\tungroup() %>% \n\tmutate(\n\t\tew_perc_change = (ew_officers - first(ew_officers)) / first(ew_officers)\n\t) %>% \n\tselect(-ew_officers) %>% \n\tungroup()\n\nforces_in_order <- chart_data %>% \n\tfilter(date == last(date)) %>% \n\tarrange(desc(perc_change)) %>% \n\tpull(\"force_name\")\n\nchart_data <- chart_data %>% \n\tmutate(force_name = fct_relevel(force_name, forces_in_order))\n```\n\n```{r build plot}\nchart <- chart_data %>% \n\tggplot(aes(\n\t  x = date, \n\t  y = perc_change, \n\t  ymin = 0, \n\t  ymax = perc_change, \n\t  colour = force_group, \n\t  fill = force_group\n\t)) + \n\tgeom_ribbon(colour = NA, alpha = 0.1) +\n\tgeom_line(aes(y = ew_perc_change, \n\t\t\t\t\t\t\t\tlinetype = \"England & Wales\\naverage change\"), \n\t\t\t\t\t\tcolour = \"grey50\") + \n\tgeom_line(size = 0.75) + \n\tgeom_point(aes(shape = last), na.rm = TRUE, show.legend = FALSE) +\n\tgeom_text(\n\t  aes(y = label_y, label = label), \n\t  size = elements$label_text_size * (7 / 9), \n\t  hjust = \"right\", \n\t  vjust = 0,\n\t  na.rm = TRUE, \n\t  show.legend = FALSE\n\t) + \n\tscale_x_continuous(breaks = c(2010, 2019), labels = c(\"'10\", \"'19\")) + \n\tscale_y_continuous(\n\t\tlabels = scales::label_percent(accuracy = 1, style_negative = \"minus\", style_positive = \"plus\")\n\t) + \n\tscale_colour_manual(\n\t\taesthetics = c(\"colour\", \"fill\"),\n\t\tvalues = unname(\n\t\t  ucl_colours_list[c(\"Mid Blue\", \"Orange\", \"Bright Red\")]\n\t\t), \n\t\tguide = guide_legend(ncol = 1), \n\t\tname = \"compared to 2010 …\"\n\t) +\n\tscale_linetype_manual(values = \"11\") +\n\tcoord_cartesian(clip = \"off\") +\n\tfacet_wrap(vars(force_name)) +\n  labs(\n    title = chart_details$title,\n    subtitle = chart_details$subtitle,\n    x = NULL,\n    y = \"change in number of police officers relative to 2010\",\n    linetype = NULL\n  ) +\n\ttheme_cjcharts() +\n\ttheme(\n\t\taxis.text = element_text(size = 7),\n\t\tlegend.key.width = unit(18, \"points\"),\n\t\tlegend.text = element_text(margin = margin(t = 4, b = 4)),\n\t\tlegend.title.align = 0,\n\t\tlegend.position = \"right\",\n\t\tlegend.margin = margin(t = 4, r = 0, b = 4, l = 0),\n\t\tlegend.box.margin = margin(),\n\t\tpanel.grid.minor.y = element_blank(),\n\t\tpanel.spacing = unit(0.4, \"lines\"),\n\t\tplot.subtitle = ggtext::element_textbox_simple(margin = margin(t = 6, b = 6)),\n\t\tstrip.text = element_text(size = 8),\n\t\tstrip.background = element_blank()\n\t)\n\n```\n\n`r chart_details$subtitle`\n\n```{r display plot, echo=FALSE, include=TRUE, cache=FALSE, fig.asp=1}\nadd_logo(chart + labs(title = NULL, subtitle = NULL), \n\t\t\t\t chart_details$source_title, chart_details$id)\n```\n\n[larger image](../`r chart_details$id`.png)\n\n```{r build-second-plot}\nchart2_data <- common_data %>% \n\tfilter(\n\t  date >= ym(\"2010-03\"), \n\t  force_name != \"London, City of\",\n\t  worker_type %in% c(\"police staff\", \"police community support officer\", \"designated officer\")\n\t) %>% \n  count(date, force_name, wt = total_fte, name = \"officers\") %>% \n\tgroup_by(force_name) %>% \n\tmutate(\n\t\tperc_change = (officers - first(officers)) / first(officers),\n\t\tdiff_perc_change = perc_change - lag(perc_change),\n\t\ttrajectory = sum(nth(diff_perc_change, -3), nth(diff_perc_change, -2), \n\t\t\t\t\t\t\t\t\t\t nth(diff_perc_change, -1)),\n\t\tforce_group = fct_case_when(\n\t\t  last(perc_change) >= 0 ~ \"more\\nstaff now\",\n\t\t  last(perc_change) > -0.05 ~ \"0–5% fewer\\nstaff now\",\n\t\t\tTRUE ~ \">5% fewer\\nstaff now\"\n\t\t),\n\t\tlast = if_else(date == last(date), TRUE, NA),\n\t\tlabel = if_else(\n\t\t  last == TRUE, \n\t\t  scales::number(\n\t\t    perc_change, \n\t\t    accuracy = 0.1, \n\t\t    scale = 100, \n\t\t    suffix = \"%\", \n\t\t    style_negative = \"minus\", \n\t\t    style_positive = \"plus\"\n\t\t  ), \n\t\t  NA_character_\n\t\t),\n\t\tlabel_y = if_else(last(perc_change) > 0, last(perc_change), 0)\n\t) %>% \n\tungroup() %>% \n\t# calculate average change for each year for England and Wales\n\tgroup_by(date) %>% \n\tmutate(ew_officers = sum(officers)) %>% \n\tungroup() %>% \n\tmutate(\n\t\tew_perc_change = (ew_officers - first(ew_officers)) / first(ew_officers)\n\t) %>% \n\tselect(-ew_officers) %>% \n\tungroup()\n\nforces_in_order2 <- chart2_data %>% \n\tfilter(date == last(date)) %>% \n\tarrange(desc(perc_change)) %>% \n\tpull(\"force_name\")\n\nchart2_data <- chart2_data %>% \n\tmutate(\n\t  force_name = fct_relevel(force_name, forces_in_order2),\n\t  force_name = fct_recode(force_name, \"Lincs§\" = \"Lincs\", \"Cleveland†\" = \"Cleveland\")\n\t)\n\nchart2 <- chart2_data %>% \n\tggplot(aes(\n\t  x = date, \n\t  y = perc_change, \n\t  ymin = 0, \n\t  ymax = perc_change, \n\t  colour = force_group, \n\t  fill = force_group\n\t)) + \n\tgeom_ribbon(colour = NA, alpha = 0.1) +\n\tgeom_line(aes(y = ew_perc_change, \n\t\t\t\t\t\t\t\tlinetype = \"England & Wales\\naverage change\"), \n\t\t\t\t\t\tcolour = \"grey50\") + \n\tgeom_line(size = 0.75) + \n\tgeom_point(aes(shape = last), na.rm = TRUE, show.legend = FALSE) +\n\tgeom_text(\n\t  aes(y = label_y, label = label), \n\t  size = elements$label_text_size * (7 / 9), \n\t  hjust = \"right\", \n\t  vjust = 0,\n\t  na.rm = TRUE, \n\t  show.legend = FALSE\n\t) + \n\tscale_x_continuous(breaks = c(2010, 2019), labels = c(\"'10\", \"'19\")) + \n\tscale_y_continuous(\n\t\tlabels = scales::label_percent(accuracy = 1, style_negative = \"minus\", style_positive = \"plus\")\n\t) + \n\tscale_colour_manual(\n\t\taesthetics = c(\"colour\", \"fill\"),\n\t\tvalues = unname(\n\t\t  ucl_colours_list[c(\"Mid Blue\", \"Orange\", \"Bright Red\")]\n\t\t), \n\t\tguide = guide_legend(ncol = 1), \n\t\tname = \"compared to 2010 …\"\n\t) +\n\tscale_linetype_manual(values = \"11\") +\n\tcoord_cartesian(clip = \"off\") +\n\tfacet_wrap(vars(force_name)) +\n  labs(\n    title = chart_details$title2,\n    subtitle = chart_details$subtitle2,\n    caption = \"\\\\* Includes community support officers and designated officers. † Cleveland outsourced most police staff from 2011 to 2020. § Lincolnshire outsourced most police staff from 2012 to 2022.\",\n    x = NULL,\n    y = \"change in number of police staff* relative to 2010\",\n    linetype = NULL\n  ) +\n\ttheme_cjcharts() +\n\ttheme(\n\t\taxis.text = element_text(size = 7),\n\t\tlegend.key.width = unit(18, \"points\"),\n\t\tlegend.text = element_text(margin = margin(t = 4, b = 4)),\n\t\tlegend.title.align = 0,\n\t\tlegend.position = \"right\",\n\t\tlegend.margin = margin(t = 4, r = 0, b = 4, l = 0),\n\t\tlegend.box.margin = margin(),\n\t\tpanel.grid.minor.y = element_blank(),\n\t\tpanel.spacing = unit(0.4, \"lines\"),\n\t\tplot.caption = ggtext::element_textbox_simple(),\n\t\tplot.caption.position = \"plot\",\n\t\tplot.subtitle = ggtext::element_textbox_simple(margin = margin(t = 6, b = 6)),\n\t\tstrip.text = element_text(size = 8),\n\t\tstrip.background = element_blank()\n\t)\n\n```\n\nThe situation is different for police staff. `r chart_details$subtitle2`\n\n```{r display plot 2, echo=FALSE, include=TRUE, cache=FALSE, fig.asp=1}\nadd_logo(chart2 + labs(title = NULL, subtitle = NULL), \n\t\t\t\t chart_details$source_title, chart_details$id)\n```\n\n[larger image](../`r chart_details$id`-staff.png)\n\n[annotated R code to produce these charts](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export charts, cache=FALSE}\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", width = 600 / 72, height = 600 / 72, units = \"in\", bg = \"white\"\n)\n\nggsave(\n\tfilename = paste0(chart_details$id, \"-staff.png\"), \n\tplot = add_logo(chart2, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", width = 600 / 72, height = 600 / 72, units = \"in\", bg = \"white\"\n)\n```\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.551","author":[{"name":"Matt Ashby"},"Matt Ashby"],"theme":["sandstone","../../custom.scss"],"date-format":"D MMM YYYY","title":"Chart: Cuts to officer numbers still being felt in some forces","date":"2022-07-27","slug":"police-uplift-2022","categories":["Crime and justice chart of the week"],"tags":["police","trends","criminal justice"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}