{"title":"Rates of most common crimes have dropped since 2010","markdown":{"yaml":{"title":"Rates of most common crimes have dropped since 2010","author":"Matt Ashby","date":"2023-04-21","categories":["Crime and justice chart of the week"],"tags":["crime","trends","CSEW"]},"headingText":"Custom packages not loaded by helpers.R","containsRefs":false,"markdown":"\n\n```{r set-knitr-options, include=FALSE}\nknitr::opts_chunk$set(cache = FALSE, include = FALSE, dev = \"ragg_png\")\n```\n\n```{r setup}\nlibrary(readxl)\n\n# Load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n\nchart_details <- list(\n\tid = \"crime-since-2010\",\n\ttitle = \"Rates of most common crimes have dropped since 2010\",\n\tsubtitle = \"The Crime Survey for England and Wales is based on a large, representative sample of households. The survey measures crime in a consistent way that is not affected by changes in police recording of crime, so it can be used to reliably track changes in crime over time. Data from the Crime Suvey show that the proportion of people who say they or their household has been a victim of most common types of crime such as violence and burglary has dropped substantially since 2010.\",\n\tsource_url = \"https://www.ons.gov.uk/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesappendixtables\",\n\tsource_title = \"Office for National Statistics\"\n)\n```\n\n```{r load-data}\nif (!file.exists(\"crime-since-2010.csv.gz\")) {\n  \n  data_file <- tempfile(fileext = \".xlsx\")\n  download.file(\n    url = \"https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesappendixtables/yearendingseptember2022/appendixtablescorrectionyesept22.xlsx\", \n    destfile = data_file\n  )\n  \n  tidy_data <- data_file |> \n    read_excel(\n      sheet = \"Table A3\", \n      skip = 9, \n      na = c(\"\", \"[x]\"), \n      col_types = \"text\"\n    ) |> \n    clean_names() |> \n    # Remove the second table in the sheet, which is to the right of the first\n    select(1:29) |> \n    select(\n      offence = offence_group_note_4_1, \n      starts_with(\"apr\"), \n      oct_2021_to_sep_2022_note_6\n    ) |> \n    pivot_longer(\n      cols = -offence, \n      names_to = \"year\", \n      values_to = \"prevalence\"\n    ) |> \n    mutate(\n      offence = str_remove(offence, \" \\\\[.+?\\\\]$\"),\n      year = str_sub(year, start = 17, end = 20),\n      across(c(year, prevalence), parse_number),\n      prevalence = prevalence / 100\n    )\n  \n  write_csv(tidy_data, \"crime-since-2010.csv.gz\")\n  \n} else {\n  \n  tidy_data <- read_csv(\"crime-since-2010.csv.gz\")\n  \n}\n```\n\n```{r wrangle-data}\nchart_data <- tidy_data |> \n  mutate(\n    offence = case_match(\n      offence,\n      \"Violence with injury\" ~ \"Violence with injury\",\n      \"Violence without injury\" ~ \"Violence without injury\",\n      \"ROBBERY\" ~ \"Personal robbery\",\n      \"Domestic burglary\" ~ \"Domestic burglary\",\n      \"Theft from the person\" ~ \"Theft from the person\",\n      \"Theft from vehicles\" ~ \"Theft from a vehicle\",\n      \"Theft of vehicles\" ~ \"Theft of a vehicle\",\n      \"Bicycle theft\" ~ \"Bicycle theft\",\n      \"CRIMINAL DAMAGE\" ~ \"Criminal damage\",\n      .default = NA_character_\n    )\n  ) |> \n  filter(!is.na(offence), year >= 2010) |> \n  # The data contains multiple prevalence values for some crimes, constructed\n  # using different denominators. The first value is for a denominator of all\n  # households and the later ones are for households who could be victimised,\n  # e.g. households with vehicles for vehicle theft. The more-specific \n  # denominators are better, so we will use those.\n  summarise(across(everything(), last), .by = c(offence, year)) |> \n  mutate(\n    change = scales::number(\n      (last(prevalence) - first(prevalence)) / first(prevalence), \n      accuracy = 1, \n      scale = 100, \n      prefix = \"**\",\n      suffix = \"%**\", \n      style_negative = \"minus\"\n    ),\n    .by = offence\n  ) |> \n  mutate(\n    offence = factor(\n      offence,\n      levels = c(\n        \"Violence with injury\", \"Violence without injury\", \"Personal robbery\",\n        \"Domestic burglary\", \"Theft from the person\", \"Criminal damage\", \n        \"Bicycle theft\", \"Theft of a vehicle\", \"Theft from a vehicle\"\n      )\n    ),\n    label = case_when(\n      year == max(year) & offence == \"Violence with injury\" ~ \n        str_glue(\"change from 2010<br>to 2022: {change}\"),\n      year == max(year) ~ change, \n      TRUE ~ NA\n    )\n  )\n```\n\n```{r}\nchart <- chart_data |> \n  ggplot(aes(x = year, y = prevalence)) +\n  geom_area(colour = NA, fill = \"white\") +\n  geom_area(\n    alpha = 0.67, \n    colour = NA, \n    fill = ucl_colours_list[[\"Bright Blue\"]]\n  ) +\n  geom_richtext(\n    aes(label = label), \n    na.rm = TRUE, \n    colour = \"white\",\n    hjust = 1,\n    fill = NA,\n    label.size = NA,\n    lineheight = elements$label_text_lineheight,\n    size = elements$label_text_size,\n    vjust = 1\n  ) +\n  geom_line(colour = ucl_colours_list[[\"Bright Blue\"]], linewidth = 1) +\n  geom_point(\n    data = filter(chart_data, !is.na(label)), \n    colour = ucl_colours_list[[\"Bright Blue\"]],\n    size = 2\n  ) +\n  scale_x_continuous(\n    breaks = c(2010, 2016, 2022), \n    expand = expansion(0.025)\n  ) +\n  scale_y_continuous(\n    limits = c(0, NA), \n    labels = scales::label_percent(), \n    expand = expansion(c(0, 0.05)),\n    position = \"right\",\n    n.breaks = 3\n  ) +\n  facet_wrap(vars(offence), scales = \"free_y\") +\n  labs(\n\t\ttitle = chart_details$title,\n\t\tsubtitle = chart_details$subtitle,\n    x = NULL,\n    y = \"percentage of people/households saying that they\\nhad been a victim at least once during the year\"\n  ) +\n  theme_cjcharts() +\n  theme(\n    legend.position = \"none\",\n\t\tplot.title = element_textbox_simple(),\n\t\tplot.subtitle = element_textbox_simple(margin = margin(t = 12, b = 6))\n  )\n```\n\n`r chart_details$subtitle`\n\n```{r display-plot, echo=FALSE, include=TRUE, warning=FALSE}\nadd_logo(\n  chart + labs(title = NULL, subtitle = NULL), \n  chart_details$source_title, \n  chart_details$id\n)\n```\n\n[larger image](`r chart_details$id`.png)\n| [annotated R code to produce this chart](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export-chart}\n# Save PNG for social media\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", \n\twidth = 600 / 72, \n\theight = 500 / 72, \n\tunits = \"in\", \n\tbg = \"white\"\n)\n```\n","srcMarkdownNoYaml":"\n\n```{r set-knitr-options, include=FALSE}\nknitr::opts_chunk$set(cache = FALSE, include = FALSE, dev = \"ragg_png\")\n```\n\n```{r setup}\n# Custom packages not loaded by helpers.R\nlibrary(readxl)\n\n# Load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n\nchart_details <- list(\n\tid = \"crime-since-2010\",\n\ttitle = \"Rates of most common crimes have dropped since 2010\",\n\tsubtitle = \"The Crime Survey for England and Wales is based on a large, representative sample of households. The survey measures crime in a consistent way that is not affected by changes in police recording of crime, so it can be used to reliably track changes in crime over time. Data from the Crime Suvey show that the proportion of people who say they or their household has been a victim of most common types of crime such as violence and burglary has dropped substantially since 2010.\",\n\tsource_url = \"https://www.ons.gov.uk/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesappendixtables\",\n\tsource_title = \"Office for National Statistics\"\n)\n```\n\n```{r load-data}\nif (!file.exists(\"crime-since-2010.csv.gz\")) {\n  \n  data_file <- tempfile(fileext = \".xlsx\")\n  download.file(\n    url = \"https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesappendixtables/yearendingseptember2022/appendixtablescorrectionyesept22.xlsx\", \n    destfile = data_file\n  )\n  \n  tidy_data <- data_file |> \n    read_excel(\n      sheet = \"Table A3\", \n      skip = 9, \n      na = c(\"\", \"[x]\"), \n      col_types = \"text\"\n    ) |> \n    clean_names() |> \n    # Remove the second table in the sheet, which is to the right of the first\n    select(1:29) |> \n    select(\n      offence = offence_group_note_4_1, \n      starts_with(\"apr\"), \n      oct_2021_to_sep_2022_note_6\n    ) |> \n    pivot_longer(\n      cols = -offence, \n      names_to = \"year\", \n      values_to = \"prevalence\"\n    ) |> \n    mutate(\n      offence = str_remove(offence, \" \\\\[.+?\\\\]$\"),\n      year = str_sub(year, start = 17, end = 20),\n      across(c(year, prevalence), parse_number),\n      prevalence = prevalence / 100\n    )\n  \n  write_csv(tidy_data, \"crime-since-2010.csv.gz\")\n  \n} else {\n  \n  tidy_data <- read_csv(\"crime-since-2010.csv.gz\")\n  \n}\n```\n\n```{r wrangle-data}\nchart_data <- tidy_data |> \n  mutate(\n    offence = case_match(\n      offence,\n      \"Violence with injury\" ~ \"Violence with injury\",\n      \"Violence without injury\" ~ \"Violence without injury\",\n      \"ROBBERY\" ~ \"Personal robbery\",\n      \"Domestic burglary\" ~ \"Domestic burglary\",\n      \"Theft from the person\" ~ \"Theft from the person\",\n      \"Theft from vehicles\" ~ \"Theft from a vehicle\",\n      \"Theft of vehicles\" ~ \"Theft of a vehicle\",\n      \"Bicycle theft\" ~ \"Bicycle theft\",\n      \"CRIMINAL DAMAGE\" ~ \"Criminal damage\",\n      .default = NA_character_\n    )\n  ) |> \n  filter(!is.na(offence), year >= 2010) |> \n  # The data contains multiple prevalence values for some crimes, constructed\n  # using different denominators. The first value is for a denominator of all\n  # households and the later ones are for households who could be victimised,\n  # e.g. households with vehicles for vehicle theft. The more-specific \n  # denominators are better, so we will use those.\n  summarise(across(everything(), last), .by = c(offence, year)) |> \n  mutate(\n    change = scales::number(\n      (last(prevalence) - first(prevalence)) / first(prevalence), \n      accuracy = 1, \n      scale = 100, \n      prefix = \"**\",\n      suffix = \"%**\", \n      style_negative = \"minus\"\n    ),\n    .by = offence\n  ) |> \n  mutate(\n    offence = factor(\n      offence,\n      levels = c(\n        \"Violence with injury\", \"Violence without injury\", \"Personal robbery\",\n        \"Domestic burglary\", \"Theft from the person\", \"Criminal damage\", \n        \"Bicycle theft\", \"Theft of a vehicle\", \"Theft from a vehicle\"\n      )\n    ),\n    label = case_when(\n      year == max(year) & offence == \"Violence with injury\" ~ \n        str_glue(\"change from 2010<br>to 2022: {change}\"),\n      year == max(year) ~ change, \n      TRUE ~ NA\n    )\n  )\n```\n\n```{r}\nchart <- chart_data |> \n  ggplot(aes(x = year, y = prevalence)) +\n  geom_area(colour = NA, fill = \"white\") +\n  geom_area(\n    alpha = 0.67, \n    colour = NA, \n    fill = ucl_colours_list[[\"Bright Blue\"]]\n  ) +\n  geom_richtext(\n    aes(label = label), \n    na.rm = TRUE, \n    colour = \"white\",\n    hjust = 1,\n    fill = NA,\n    label.size = NA,\n    lineheight = elements$label_text_lineheight,\n    size = elements$label_text_size,\n    vjust = 1\n  ) +\n  geom_line(colour = ucl_colours_list[[\"Bright Blue\"]], linewidth = 1) +\n  geom_point(\n    data = filter(chart_data, !is.na(label)), \n    colour = ucl_colours_list[[\"Bright Blue\"]],\n    size = 2\n  ) +\n  scale_x_continuous(\n    breaks = c(2010, 2016, 2022), \n    expand = expansion(0.025)\n  ) +\n  scale_y_continuous(\n    limits = c(0, NA), \n    labels = scales::label_percent(), \n    expand = expansion(c(0, 0.05)),\n    position = \"right\",\n    n.breaks = 3\n  ) +\n  facet_wrap(vars(offence), scales = \"free_y\") +\n  labs(\n\t\ttitle = chart_details$title,\n\t\tsubtitle = chart_details$subtitle,\n    x = NULL,\n    y = \"percentage of people/households saying that they\\nhad been a victim at least once during the year\"\n  ) +\n  theme_cjcharts() +\n  theme(\n    legend.position = \"none\",\n\t\tplot.title = element_textbox_simple(),\n\t\tplot.subtitle = element_textbox_simple(margin = margin(t = 12, b = 6))\n  )\n```\n\n`r chart_details$subtitle`\n\n```{r display-plot, echo=FALSE, include=TRUE, warning=FALSE}\nadd_logo(\n  chart + labs(title = NULL, subtitle = NULL), \n  chart_details$source_title, \n  chart_details$id\n)\n```\n\n[larger image](`r chart_details$id`.png)\n| [annotated R code to produce this chart](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export-chart}\n# Save PNG for social media\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", \n\twidth = 600 / 72, \n\theight = 500 / 72, \n\tunits = \"in\", \n\tbg = \"white\"\n)\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.551","author":[{"name":"Matt Ashby"},"Matt Ashby"],"theme":["sandstone","../../custom.scss"],"date-format":"D MMM YYYY","title":"Rates of most common crimes have dropped since 2010","date":"2023-04-21","categories":["Crime and justice chart of the week"],"tags":["crime","trends","CSEW"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}