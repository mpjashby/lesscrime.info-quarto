{"title":"Chart: For most offences prison is the exception, not the rule","markdown":{"yaml":{"title":"Chart: For most offences prison is the exception, not the rule","author":"Matt Ashby","date":"2019-09-02","slug":"prison-likelihood","categories":["Crime and justice chart of the week"],"tags":["prison","age","criminal justice"]},"headingText":"custom packages not loaded by helpers.R","containsRefs":false,"markdown":"\n\n```{r set knitr options, include=FALSE}\nknitr::opts_chunk$set(cache = TRUE, include=FALSE)\n```\n\n```{r set chart parameters}\nchart_details <- list(\n\tid = \"prison-likelihood\",\n\ttitle = \"For most offences prison is the exception, not the rule\",\n\tsubtitle = \"Of the 663,000 non-motoring offences for which people were sentenced in 2018, only about 11% resulted in a prison sentence. Some convictions, like rape and robbery, almost always result in a prison sentence (at least for adult offenders), while other offences very rarely result in imprisonment.\",\n\tsource_url = \"https://www.gov.uk/government/statistics/criminal-justice-system-statistics-quarterly-december-2018\",\n\tsource_title = \"Ministry of Justice, 2019\"\n)\n```\n\n```{r load packages and helper}\n\n# load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n```\n\n```{r get and tidy data}\nif (!file.exists(paste0(chart_details$id, \"-data.csv.gz\"))) {\n\t\n\t# download data\n\t# data_file <- tempfile()\n\t# GET(\"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/802314/outcomes-by-offence-tool-2018.xlsx\", write_disk(data_file), progress())\n\n  # The downloaded data are in a .xls file, but the data are hidden in a pivot\n  # table rather than a simple sheet. The data can be revealed by *selecting all\n\t# the cells* in the pivot table, right-clicking on the pivot table and \n\t# clicking 'Show Details' then saving the resulting sheet as a CSV file\n\t\n\t# read data\n\tfile_data <- read_csv(\"prison-likelihood-data-raw.csv\")\n\t\n\t# tidy data\n\ttidy_data <- file_data %>%\n\t\t# clean variable names\n\t\tclean_names()\n\t\n\t# save tidy data\n\twrite_csv(tidy_data, paste0(chart_details$id, \"-data.csv.gz\"))\t\n\t\n} else {\n\t\n\t# load tidy data\n\ttidy_data <- read_csv(paste0(chart_details$id, \"-data.csv.gz\"))\n\t\n}\n```\n\n```{r count total sentences, eval=FALSE, include=FALSE}\ntidy_data %>% \n\tfilter(\n\t\tyear == 2018, \n\t\tperson_other == \"01: Person\",\n\t\toffence_group != \"12: Summary motoring\"\n\t) %>% \n\tsummarise(sentenced = sum(sentenced), \n\t\t\t\t\t\tcustody = sum(total_immediate_custody)) %>% \n\tmutate(`custody proportion` = custody / sentenced) %>% \n\tgather(key = \"category\", value = \"count\") %>% \n\tmutate(count = ifelse(category == \"custody proportion\", \n\t\t\t\t\t\t\t\t\t\t\t\tscales::percent(count, accuracy = 0.1), \n\t\t\t\t\t\t\t\t\t\t\t\tscales::comma(count, accuracy = 1000)))\n```\n\n\n\n```{r prepare plot data}\nchart_data <- tidy_data %>% \n\tfilter(year == 2018, person_other == \"01: Person\") %>% \n\tmutate(detailed_offence = case_when(\n\t  offence == \"1 Murder\" ~ \"murder\",\n\t\tstr_detect(offence, \"Sexual assault\") | str_detect(offence, \"^Indecent assault\") ~ \n\t\t\t\"sexual assault\",\n\t\tstr_detect(offence, \"Rape of\") ~ \"rape\",\n\t\toffence == \"46 Theft from Shops\" ~ \"shoplifting\",\n\t\tstr_detect(offence, \"^92E\") ~ \"cannabis possession\",\n\t\tstr_detect(offence, \"Burglary\") ~ \"burglary\",\n\t\toffence == \"8.10 Breach of a restraining order\" ~ \n\t\t\t\"breach of restraining order\",\n\t\toffence == \"8.01 Assault occasioning actual bodily harm\" ~ \n\t\t\t\"causing actual bodily harm\",\n\t\toffence == \"10D Possession of article with blade or point\" ~ \n\t\t\t\"possess bladed article\",\n\t\tstr_detect(offence, \"^53C\") | str_detect(offence, \"^53D\") ~ \n\t\t\t\"fraud by false representation\",\n\t\toffence == \"34 Robbery\" ~ \"robbery\",\n\t\toffence == \"41 Theft by an Employee\" ~ \"theft by employee\",\n\t\tstr_detect(offence, \"^92A.09\") ~ \"class A drug supply (e.g. cocaine)\",\n\t\tstr_detect(offence, \"^92A.10\") ~ \"class B drug supply (e.g. cannabis)\",\n\t\tstr_detect(offence, \"^92D.01\") ~ \"class A drug possession\",\n\t\tstr_detect(offence, \"grievous bodily harm\") ~ \n\t\t\t\"causing grievous bodily harm\",\n\t\toffence == \"54 Handling Stolen Goods\" ~ \"handling stolen goods\",\n\t\toffence == \"10C.2 Possession of other weapons - triable either way\" ~ \n\t\t\t\"possess offensive weapon\",\n\t\toffence == \"44 Theft of Pedal Cycle\" ~ \"pedal cycle theft\",\n\t\toffence %in% c(\"130 Theft of a motor vehicle  - summary (MOT)\", \"48 Theft of a motor vehicle (excl. aggravated vehicle taking) - triable either way (MOT)\") ~ \n\t\t\t\"motor vehicle theft/taking\",\n\t\toffence == \"45 Theft from Vehicle\" ~ \"theft from motor vehicle\",\n\t\tTRUE ~ \"other\"\n\t)) %>% \n\tfilter(detailed_offence != \"other\") %>% \n\tmutate(age_group = as.character(fct_recode(\n\t\tage_group, \n\t\t\"juvenile offenders\" = \"01: Juveniles\",\n\t\t\"adult offenders\" = \"02: Young adults\", \n\t\t\"adult offenders\" = \"03: Adults\")\n\t)) %>% \n\tgroup_by(detailed_offence, age_group) %>% \n\tsummarise(sentenced = sum(sentenced), \n\t\t\t\t\t\tcustody = sum(total_immediate_custody)) %>% \n\tungroup() %>% \n\tmutate(custody_prop = custody / sentenced)\n\n# chart_data <- tidy_data %>% \n# \t# filter(offence_type %in% c(\"01: Indictable only\", \"02: Triable either way\")) %>% \n# \tmutate(detailed_offence = case_when(\n# \t\toffence == \"1 Murder\" ~ \"murder\",\n# \t\tstr_detect(detailed_offence, \"^Sexual assault\") ~ \"sexual assault\",\n# \t\tstr_detect(detailed_offence, \"^Rape\") ~ \"rape\",\n# \t\tdetailed_offence == \"Theft from shops\" ~ \"shoplifting\",\n# \t\tdetailed_offence == \"Having possession of a controlled drug - class B (cannabis, including cannabis resin, cannabinol and cannabinol derivatives)\" ~ \"cannabis possession\",\n# \t\tstr_detect(detailed_offence, \"^Burglary\") | detailed_offence == \"Other burglary in a dwelling\" ~\n# \t\t\t\"burglary\",\n# \t\tdetailed_offence == \"Breach of a restraining order\" ~ \n# \t\t\t\"breach of restraining order\",\n# \t\tdetailed_offence == \"Assault occasioning actual bodily harm\" ~ \n# \t\t\t\"causing actual bodily harm\",\n# \t\tdetailed_offence == \"Having an article with a blade or point in a public place\" ~\n# \t\t\t\"possess bladed article\",\n# \t\tstr_detect(detailed_offence, \"^Fraud by false representation\") ~ \n# \t\t\t\"fraud by false representation\",\n# \t\tdetailed_offence == \"Robbery\" ~ \"robbery\",\n# \t\tdetailed_offence == \"Theft by an employee\" ~ \"theft by employee\",\n# \t\tstr_detect(str_to_lower(detailed_offence), \"cocaine\") & str_detect(str_to_lower(detailed_offence), \"supply\") ~ \"cocaine supply\",\n# \t\tstr_detect(str_to_lower(detailed_offence), \"cannabis\") & str_detect(str_to_lower(detailed_offence), \"supply\") ~ \n# \t\t\t\"cannabis supply\",\n# \t\tdetailed_offence == \"Having possession of a controlled drug - class A (cocaine)\" ~\n# \t\t\t\"cocaine possession\",\n# \t\tdetailed_offence %in% c(\"Wound/inflict grievous bodily harm without intent\", \"Wounding with intent to cause grievous bodily harm\") ~ \n# \t\t\t\"causing grievous bodily harm\",\n# \t\tstr_detect(str_to_lower(detailed_offence), \"stolen\") & str_detect(str_to_lower(detailed_offence), \"goods\") ~ \"handling stolen goods\",\n# \t\tdetailed_offence == \"Possession of offensive weapons without lawful authority or reasonable excuse\" ~\n# \t\t\t\"possess offensive weapon\",\n# \t\tdetailed_offence == \"Theft of pedal cycle\" ~ \"pedal cycle theft\",\n# \t\tdetailed_offence %in% c(\"Unauthorised taking or driving or attempt taking or driving of a motor vehicle\", \"Theft of a motor vehicle (excluding aggravated vehicle taking) - triable either way\") ~ \n# \t\t\t\"motor vehicle theft/taking\",\n# \t\tdetailed_offence == \"Stealing from vehicles: from motor vehicles\" ~ \"theft from motor vehicle\",\n# \t\tTRUE ~ \"other\"\n# \t\t# TRUE ~ detailed_offence\n# \t)) %>% \n# \tfilter(detailed_offence != \"other\") %>% \n# \t# count(detailed_offence, wt = sentenced, sort = TRUE)\n# \tmutate(\n# \t\tage_group = as.character(fct_recode(age_group, \n# \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"juvenile offenders\" = \"01: Juveniles\",\n# \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"adult offenders\" = \"02: Young adults\", \n# \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"adult offenders\" = \"03: Adults\")),\n# \t\toffence_group = as.character(fct_recode(\n# \t\t\toffence_group,\n# \t\t\t\"violent or sexual crime\" = \"01: Violence against the person\", \n# \t\t\t\"violent or sexual crime\" = \"02: Sexual offences\",\n# \t\t\t\"violent or sexual crime\" = \"03: Robbery\",\n# \t\t\t\"theft or fraud\" = \"04: Theft Offences\",\n# \t\t\t\"theft or fraud\" = \"10: Fraud Offences\",\n# \t\t\t\"other crime\" = \"06: Drug offences\",\n# \t\t\t\"other crime\" = \"07: Possession of weapons\",\n# \t\t\t\"other crime\" = \"09: Miscellaneous crimes against society\"\n# \t\t))\n# \t) %>% \n# \tgroup_by(offence_group, detailed_offence, age_group) %>% \n# \tsummarise(sentenced = sum(sentenced), custody = sum(immediate_custody)) %>% \n# \tungroup() %>% \n# \tmutate(custody_prop = custody / sentenced)\n\noffence_order <- chart_data %>% \n\tfilter(age_group == \"adult offenders\") %>% \n\tarrange(desc(custody_prop)) %>% \n\tpull(detailed_offence)\n\nchart_data <- chart_data %>% \n\tmutate(\n\t\tage_group = factor(age_group),\n\t\tdetailed_offence = fct_rev(factor(detailed_offence, levels = offence_order))\n\t)\n\n# add chart labels\nchart_labels <- tribble(\n\t~x, ~y, ~xend, ~yend, ~age_group, ~label, ~hjust, ~vjust, ~curve,\n\t20, 0.35, 18.5, 0.45, \"juvenile offenders\", balance_lines(\"most children convicted of rape (and all offences except murder) received a non-custodial sentence\", 5), \"left\", \"top\", \"left\",\n\t16, 0.66, 14.5, 0.76, \"adult offenders\", balance_lines(\"64% of adults convicted of burglary were imprisoned, compared to 17% of juveniles\", 5), \"center\", \"top\", \"left\",\n\t1, 0.04, 2, 0.34, \"adult offenders\", balance_lines(\"the maximum penalty for cannabis possession is 5 years in prison, but in practice almost no offenders were imprisoned\", 5), \"left\", \"bottom\", \"right\",\n) %>% \n\t# order factor levels according to order in chart data, to maintain facet and\n\t# legend order\n\tmutate(\n\t\tage_group = factor(age_group, levels = levels(chart_data$age_group))\n\t)\n```\n\n```{r build plot}\nchart <- ggplot(chart_data, aes(detailed_offence, custody_prop, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill = age_group)) +\n\tgeom_col(width = 0.8) +\n\t# add explanatory labels\n\tgeom_curve(aes(x = x, y = y, xend = xend, yend = yend),\n\t\t\t\t\t\t data = filter(chart_labels, curve == \"right\"), inherit.aes = FALSE, \n\t\t\t\t\t\t curvature = elements$label_line_curvature, \n\t\t\t\t\t\t colour = elements$label_line_colour, \n\t\t\t\t\t\t arrow = elements$label_arrow, show.legend = FALSE) +\n\tgeom_segment(aes(x = x, y = y, xend = xend, yend = yend),\n\t\t\t\t\t\t data = filter(chart_labels, curve == \"straight\"), \n\t\t\t\t\t\t inherit.aes = FALSE, colour = elements$label_line_colour, \n\t\t\t\t\t\t arrow = elements$label_arrow, show.legend = FALSE) +\n\tgeom_curve(aes(x = x, y = y, xend = xend, yend = yend),\n\t\t\t\t\t\t data = filter(chart_labels, curve == \"left\"), inherit.aes = FALSE, \n\t\t\t\t\t\t curvature = elements$label_line_curvature * -1, \n\t\t\t\t\t\t colour = elements$label_line_colour, \n\t\t\t\t\t\t arrow = elements$label_arrow, show.legend = FALSE) +\n\tgeom_label(aes(x = xend, y = yend, label = label, hjust = hjust, \n\t\t\t\t\t\t\t\t vjust = vjust),\n\t\t\t\t\t\tdata = chart_labels, inherit.aes = FALSE, \n\t\t\t\t\t\tcolour = elements$label_text_colour,\n\t\t\t\t\t\tfill = elements$label_text_fill, size = elements$label_text_size, \n\t\t\t\t\t\tlineheight = elements$label_text_lineheight,\n\t\t\t\t\t\tlabel.size = NA, show.legend = FALSE) +\n\t# end of explanatory labels\n\tscale_y_continuous(limits = c(0, 1), labels = scales::percent_format(),\n\t\t\t\t\t\t\t\t\t\t expand = expand_scale(mult = c(0, 0.03))) +\n\tscale_fill_manual(\n\t\tvalues = unname(ucl_colours_list[c(\"Light Blue\", \"Light Green\")])\n\t) +\n\tcoord_flip(clip = \"off\") +\n\tfacet_grid(cols = vars(age_group)) +\n\tlabs(\n    title = chart_details$title,\n    subtitle = format_subtitle(chart_details$subtitle, .width = 80),\n\t\tx = NULL,\n\t\ty = \"proportion of sentences that were an immediate custodial sentence, 2018\",\n\t\tfill = NULL\n\t) +\n\ttheme_cjcharts() +\n\ttheme(\n\t\taxis.ticks.x = element_line(),\n\t\taxis.ticks.y = element_blank(),\n\t\tlegend.position = \"none\",\n\t\tpanel.grid.major.x = element_line(),\n\t\tpanel.grid.minor.x = element_line(),\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor.y = element_blank(),\n\t\tpanel.spacing = unit(1, \"lines\")\n\t)\n```\n\n\n`r chart_details$subtitle`\n\n```{r display plot, echo=FALSE, include=TRUE}\nadd_logo(chart + labs(title = NULL, subtitle = NULL), \n\t\t\t\t chart_details$source_title, chart_details$id)\n```\n\n[larger image](../`r chart_details$id`.png)\n| [annotated R code to produce this chart](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export chart}\n# save PNG for social media\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", width = 600 / 72, height = 400 / 72, units = \"in\"\n)\n```\n","srcMarkdownNoYaml":"\n\n```{r set knitr options, include=FALSE}\nknitr::opts_chunk$set(cache = TRUE, include=FALSE)\n```\n\n```{r set chart parameters}\nchart_details <- list(\n\tid = \"prison-likelihood\",\n\ttitle = \"For most offences prison is the exception, not the rule\",\n\tsubtitle = \"Of the 663,000 non-motoring offences for which people were sentenced in 2018, only about 11% resulted in a prison sentence. Some convictions, like rape and robbery, almost always result in a prison sentence (at least for adult offenders), while other offences very rarely result in imprisonment.\",\n\tsource_url = \"https://www.gov.uk/government/statistics/criminal-justice-system-statistics-quarterly-december-2018\",\n\tsource_title = \"Ministry of Justice, 2019\"\n)\n```\n\n```{r load packages and helper}\n# custom packages not loaded by helpers.R\n\n# load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n```\n\n```{r get and tidy data}\nif (!file.exists(paste0(chart_details$id, \"-data.csv.gz\"))) {\n\t\n\t# download data\n\t# data_file <- tempfile()\n\t# GET(\"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/802314/outcomes-by-offence-tool-2018.xlsx\", write_disk(data_file), progress())\n\n  # The downloaded data are in a .xls file, but the data are hidden in a pivot\n  # table rather than a simple sheet. The data can be revealed by *selecting all\n\t# the cells* in the pivot table, right-clicking on the pivot table and \n\t# clicking 'Show Details' then saving the resulting sheet as a CSV file\n\t\n\t# read data\n\tfile_data <- read_csv(\"prison-likelihood-data-raw.csv\")\n\t\n\t# tidy data\n\ttidy_data <- file_data %>%\n\t\t# clean variable names\n\t\tclean_names()\n\t\n\t# save tidy data\n\twrite_csv(tidy_data, paste0(chart_details$id, \"-data.csv.gz\"))\t\n\t\n} else {\n\t\n\t# load tidy data\n\ttidy_data <- read_csv(paste0(chart_details$id, \"-data.csv.gz\"))\n\t\n}\n```\n\n```{r count total sentences, eval=FALSE, include=FALSE}\ntidy_data %>% \n\tfilter(\n\t\tyear == 2018, \n\t\tperson_other == \"01: Person\",\n\t\toffence_group != \"12: Summary motoring\"\n\t) %>% \n\tsummarise(sentenced = sum(sentenced), \n\t\t\t\t\t\tcustody = sum(total_immediate_custody)) %>% \n\tmutate(`custody proportion` = custody / sentenced) %>% \n\tgather(key = \"category\", value = \"count\") %>% \n\tmutate(count = ifelse(category == \"custody proportion\", \n\t\t\t\t\t\t\t\t\t\t\t\tscales::percent(count, accuracy = 0.1), \n\t\t\t\t\t\t\t\t\t\t\t\tscales::comma(count, accuracy = 1000)))\n```\n\n\n\n```{r prepare plot data}\nchart_data <- tidy_data %>% \n\tfilter(year == 2018, person_other == \"01: Person\") %>% \n\tmutate(detailed_offence = case_when(\n\t  offence == \"1 Murder\" ~ \"murder\",\n\t\tstr_detect(offence, \"Sexual assault\") | str_detect(offence, \"^Indecent assault\") ~ \n\t\t\t\"sexual assault\",\n\t\tstr_detect(offence, \"Rape of\") ~ \"rape\",\n\t\toffence == \"46 Theft from Shops\" ~ \"shoplifting\",\n\t\tstr_detect(offence, \"^92E\") ~ \"cannabis possession\",\n\t\tstr_detect(offence, \"Burglary\") ~ \"burglary\",\n\t\toffence == \"8.10 Breach of a restraining order\" ~ \n\t\t\t\"breach of restraining order\",\n\t\toffence == \"8.01 Assault occasioning actual bodily harm\" ~ \n\t\t\t\"causing actual bodily harm\",\n\t\toffence == \"10D Possession of article with blade or point\" ~ \n\t\t\t\"possess bladed article\",\n\t\tstr_detect(offence, \"^53C\") | str_detect(offence, \"^53D\") ~ \n\t\t\t\"fraud by false representation\",\n\t\toffence == \"34 Robbery\" ~ \"robbery\",\n\t\toffence == \"41 Theft by an Employee\" ~ \"theft by employee\",\n\t\tstr_detect(offence, \"^92A.09\") ~ \"class A drug supply (e.g. cocaine)\",\n\t\tstr_detect(offence, \"^92A.10\") ~ \"class B drug supply (e.g. cannabis)\",\n\t\tstr_detect(offence, \"^92D.01\") ~ \"class A drug possession\",\n\t\tstr_detect(offence, \"grievous bodily harm\") ~ \n\t\t\t\"causing grievous bodily harm\",\n\t\toffence == \"54 Handling Stolen Goods\" ~ \"handling stolen goods\",\n\t\toffence == \"10C.2 Possession of other weapons - triable either way\" ~ \n\t\t\t\"possess offensive weapon\",\n\t\toffence == \"44 Theft of Pedal Cycle\" ~ \"pedal cycle theft\",\n\t\toffence %in% c(\"130 Theft of a motor vehicle  - summary (MOT)\", \"48 Theft of a motor vehicle (excl. aggravated vehicle taking) - triable either way (MOT)\") ~ \n\t\t\t\"motor vehicle theft/taking\",\n\t\toffence == \"45 Theft from Vehicle\" ~ \"theft from motor vehicle\",\n\t\tTRUE ~ \"other\"\n\t)) %>% \n\tfilter(detailed_offence != \"other\") %>% \n\tmutate(age_group = as.character(fct_recode(\n\t\tage_group, \n\t\t\"juvenile offenders\" = \"01: Juveniles\",\n\t\t\"adult offenders\" = \"02: Young adults\", \n\t\t\"adult offenders\" = \"03: Adults\")\n\t)) %>% \n\tgroup_by(detailed_offence, age_group) %>% \n\tsummarise(sentenced = sum(sentenced), \n\t\t\t\t\t\tcustody = sum(total_immediate_custody)) %>% \n\tungroup() %>% \n\tmutate(custody_prop = custody / sentenced)\n\n# chart_data <- tidy_data %>% \n# \t# filter(offence_type %in% c(\"01: Indictable only\", \"02: Triable either way\")) %>% \n# \tmutate(detailed_offence = case_when(\n# \t\toffence == \"1 Murder\" ~ \"murder\",\n# \t\tstr_detect(detailed_offence, \"^Sexual assault\") ~ \"sexual assault\",\n# \t\tstr_detect(detailed_offence, \"^Rape\") ~ \"rape\",\n# \t\tdetailed_offence == \"Theft from shops\" ~ \"shoplifting\",\n# \t\tdetailed_offence == \"Having possession of a controlled drug - class B (cannabis, including cannabis resin, cannabinol and cannabinol derivatives)\" ~ \"cannabis possession\",\n# \t\tstr_detect(detailed_offence, \"^Burglary\") | detailed_offence == \"Other burglary in a dwelling\" ~\n# \t\t\t\"burglary\",\n# \t\tdetailed_offence == \"Breach of a restraining order\" ~ \n# \t\t\t\"breach of restraining order\",\n# \t\tdetailed_offence == \"Assault occasioning actual bodily harm\" ~ \n# \t\t\t\"causing actual bodily harm\",\n# \t\tdetailed_offence == \"Having an article with a blade or point in a public place\" ~\n# \t\t\t\"possess bladed article\",\n# \t\tstr_detect(detailed_offence, \"^Fraud by false representation\") ~ \n# \t\t\t\"fraud by false representation\",\n# \t\tdetailed_offence == \"Robbery\" ~ \"robbery\",\n# \t\tdetailed_offence == \"Theft by an employee\" ~ \"theft by employee\",\n# \t\tstr_detect(str_to_lower(detailed_offence), \"cocaine\") & str_detect(str_to_lower(detailed_offence), \"supply\") ~ \"cocaine supply\",\n# \t\tstr_detect(str_to_lower(detailed_offence), \"cannabis\") & str_detect(str_to_lower(detailed_offence), \"supply\") ~ \n# \t\t\t\"cannabis supply\",\n# \t\tdetailed_offence == \"Having possession of a controlled drug - class A (cocaine)\" ~\n# \t\t\t\"cocaine possession\",\n# \t\tdetailed_offence %in% c(\"Wound/inflict grievous bodily harm without intent\", \"Wounding with intent to cause grievous bodily harm\") ~ \n# \t\t\t\"causing grievous bodily harm\",\n# \t\tstr_detect(str_to_lower(detailed_offence), \"stolen\") & str_detect(str_to_lower(detailed_offence), \"goods\") ~ \"handling stolen goods\",\n# \t\tdetailed_offence == \"Possession of offensive weapons without lawful authority or reasonable excuse\" ~\n# \t\t\t\"possess offensive weapon\",\n# \t\tdetailed_offence == \"Theft of pedal cycle\" ~ \"pedal cycle theft\",\n# \t\tdetailed_offence %in% c(\"Unauthorised taking or driving or attempt taking or driving of a motor vehicle\", \"Theft of a motor vehicle (excluding aggravated vehicle taking) - triable either way\") ~ \n# \t\t\t\"motor vehicle theft/taking\",\n# \t\tdetailed_offence == \"Stealing from vehicles: from motor vehicles\" ~ \"theft from motor vehicle\",\n# \t\tTRUE ~ \"other\"\n# \t\t# TRUE ~ detailed_offence\n# \t)) %>% \n# \tfilter(detailed_offence != \"other\") %>% \n# \t# count(detailed_offence, wt = sentenced, sort = TRUE)\n# \tmutate(\n# \t\tage_group = as.character(fct_recode(age_group, \n# \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"juvenile offenders\" = \"01: Juveniles\",\n# \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"adult offenders\" = \"02: Young adults\", \n# \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"adult offenders\" = \"03: Adults\")),\n# \t\toffence_group = as.character(fct_recode(\n# \t\t\toffence_group,\n# \t\t\t\"violent or sexual crime\" = \"01: Violence against the person\", \n# \t\t\t\"violent or sexual crime\" = \"02: Sexual offences\",\n# \t\t\t\"violent or sexual crime\" = \"03: Robbery\",\n# \t\t\t\"theft or fraud\" = \"04: Theft Offences\",\n# \t\t\t\"theft or fraud\" = \"10: Fraud Offences\",\n# \t\t\t\"other crime\" = \"06: Drug offences\",\n# \t\t\t\"other crime\" = \"07: Possession of weapons\",\n# \t\t\t\"other crime\" = \"09: Miscellaneous crimes against society\"\n# \t\t))\n# \t) %>% \n# \tgroup_by(offence_group, detailed_offence, age_group) %>% \n# \tsummarise(sentenced = sum(sentenced), custody = sum(immediate_custody)) %>% \n# \tungroup() %>% \n# \tmutate(custody_prop = custody / sentenced)\n\noffence_order <- chart_data %>% \n\tfilter(age_group == \"adult offenders\") %>% \n\tarrange(desc(custody_prop)) %>% \n\tpull(detailed_offence)\n\nchart_data <- chart_data %>% \n\tmutate(\n\t\tage_group = factor(age_group),\n\t\tdetailed_offence = fct_rev(factor(detailed_offence, levels = offence_order))\n\t)\n\n# add chart labels\nchart_labels <- tribble(\n\t~x, ~y, ~xend, ~yend, ~age_group, ~label, ~hjust, ~vjust, ~curve,\n\t20, 0.35, 18.5, 0.45, \"juvenile offenders\", balance_lines(\"most children convicted of rape (and all offences except murder) received a non-custodial sentence\", 5), \"left\", \"top\", \"left\",\n\t16, 0.66, 14.5, 0.76, \"adult offenders\", balance_lines(\"64% of adults convicted of burglary were imprisoned, compared to 17% of juveniles\", 5), \"center\", \"top\", \"left\",\n\t1, 0.04, 2, 0.34, \"adult offenders\", balance_lines(\"the maximum penalty for cannabis possession is 5 years in prison, but in practice almost no offenders were imprisoned\", 5), \"left\", \"bottom\", \"right\",\n) %>% \n\t# order factor levels according to order in chart data, to maintain facet and\n\t# legend order\n\tmutate(\n\t\tage_group = factor(age_group, levels = levels(chart_data$age_group))\n\t)\n```\n\n```{r build plot}\nchart <- ggplot(chart_data, aes(detailed_offence, custody_prop, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill = age_group)) +\n\tgeom_col(width = 0.8) +\n\t# add explanatory labels\n\tgeom_curve(aes(x = x, y = y, xend = xend, yend = yend),\n\t\t\t\t\t\t data = filter(chart_labels, curve == \"right\"), inherit.aes = FALSE, \n\t\t\t\t\t\t curvature = elements$label_line_curvature, \n\t\t\t\t\t\t colour = elements$label_line_colour, \n\t\t\t\t\t\t arrow = elements$label_arrow, show.legend = FALSE) +\n\tgeom_segment(aes(x = x, y = y, xend = xend, yend = yend),\n\t\t\t\t\t\t data = filter(chart_labels, curve == \"straight\"), \n\t\t\t\t\t\t inherit.aes = FALSE, colour = elements$label_line_colour, \n\t\t\t\t\t\t arrow = elements$label_arrow, show.legend = FALSE) +\n\tgeom_curve(aes(x = x, y = y, xend = xend, yend = yend),\n\t\t\t\t\t\t data = filter(chart_labels, curve == \"left\"), inherit.aes = FALSE, \n\t\t\t\t\t\t curvature = elements$label_line_curvature * -1, \n\t\t\t\t\t\t colour = elements$label_line_colour, \n\t\t\t\t\t\t arrow = elements$label_arrow, show.legend = FALSE) +\n\tgeom_label(aes(x = xend, y = yend, label = label, hjust = hjust, \n\t\t\t\t\t\t\t\t vjust = vjust),\n\t\t\t\t\t\tdata = chart_labels, inherit.aes = FALSE, \n\t\t\t\t\t\tcolour = elements$label_text_colour,\n\t\t\t\t\t\tfill = elements$label_text_fill, size = elements$label_text_size, \n\t\t\t\t\t\tlineheight = elements$label_text_lineheight,\n\t\t\t\t\t\tlabel.size = NA, show.legend = FALSE) +\n\t# end of explanatory labels\n\tscale_y_continuous(limits = c(0, 1), labels = scales::percent_format(),\n\t\t\t\t\t\t\t\t\t\t expand = expand_scale(mult = c(0, 0.03))) +\n\tscale_fill_manual(\n\t\tvalues = unname(ucl_colours_list[c(\"Light Blue\", \"Light Green\")])\n\t) +\n\tcoord_flip(clip = \"off\") +\n\tfacet_grid(cols = vars(age_group)) +\n\tlabs(\n    title = chart_details$title,\n    subtitle = format_subtitle(chart_details$subtitle, .width = 80),\n\t\tx = NULL,\n\t\ty = \"proportion of sentences that were an immediate custodial sentence, 2018\",\n\t\tfill = NULL\n\t) +\n\ttheme_cjcharts() +\n\ttheme(\n\t\taxis.ticks.x = element_line(),\n\t\taxis.ticks.y = element_blank(),\n\t\tlegend.position = \"none\",\n\t\tpanel.grid.major.x = element_line(),\n\t\tpanel.grid.minor.x = element_line(),\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor.y = element_blank(),\n\t\tpanel.spacing = unit(1, \"lines\")\n\t)\n```\n\n\n`r chart_details$subtitle`\n\n```{r display plot, echo=FALSE, include=TRUE}\nadd_logo(chart + labs(title = NULL, subtitle = NULL), \n\t\t\t\t chart_details$source_title, chart_details$id)\n```\n\n[larger image](../`r chart_details$id`.png)\n| [annotated R code to produce this chart](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export chart}\n# save PNG for social media\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", width = 600 / 72, height = 400 / 72, units = \"in\"\n)\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","author":[{"name":"Matt Ashby"},"Matt Ashby"],"theme":["sandstone","../../custom.scss"],"date-format":"D MMM YYYY","title":"Chart: For most offences prison is the exception, not the rule","date":"2019-09-02","slug":"prison-likelihood","categories":["Crime and justice chart of the week"],"tags":["prison","age","criminal justice"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}