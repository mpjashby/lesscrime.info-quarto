{"title":"Worry about many types of ASB is at its lowest level for 20 years","markdown":{"yaml":{"title":"Worry about many types of ASB is at its lowest level for 20 years","author":"Matt Ashby","date":"2023-04-21","slug":"asb-trends","categories":["Crime and justice chart of the week"],"tags":["ASB","trends","CSEW","perceptions"]},"headingText":"Custom packages not loaded by helpers.R","containsRefs":false,"markdown":"\n\n\n```{r set-knitr-options, include=FALSE}\nknitr::opts_chunk$set(cache = FALSE, include = FALSE, dev = \"ragg_png\")\n```\n\n```{r setup}\nlibrary(readxl)\n\n# Load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n\nchart_details <- list(\n\tid = \"asb-trends\",\n\ttitle = \"Worry about many types of ASB is at its lowest level for 20 years\",\n\tsubtitle = \"The Crime Survey for England and Wales asks people every year if they are worried about different types of anti-social behaviour (ASB) in the area where they live. For many types of ASB, in 2022 the percentage of people saying many types of ASB were a very/fairly big problem in their area was at or near its lowest level since records began in 2002.\",\n\tsource_url = \"https://www.ons.gov.uk/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesannualsupplementarytables\",\n\tsource_title = \"Office for National Statistics\"\n)\n```\n\n```{r load-data}\nif (!file.exists(str_glue(\"{chart_details$id}.csv.gz\"))) {\n  \n  data_file <- tempfile(fileext = \".xlsx\")\n  download.file(\n    url = \"https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesannualsupplementarytables/march2020/annualsupplementarytablesmar201.xlsx\", \n    destfile = data_file\n  )\n  \n  tidy_data <- data_file |> \n    read_excel(\n        sheet = \"Table S34\", \n        skip = 3, \n        na = c(\"\", \":\"), \n        col_types = \"text\"\n    ) |> \n    clean_names() |> \n    slice(3, 7:14) |> \n    select(type = x1, starts_with(\"apr_\")) |> \n    pivot_longer(cols = -type, names_to = \"year\", values_to = \"percentage\") |> \n    mutate(\n      type = str_remove(type, \"[\\\\d\\\\,]+?$\"),\n      year = str_sub(year, start = 15, end = 16), \n      year = str_glue(\"20{year}\"), \n      across(c(year, percentage), parse_number),\n      percentage = percentage / 100\n    ) |> \n    filter(!is.na(type))\n  \n  write_csv(tidy_data, str_glue(\"{chart_details$id}.csv.gz\"))\n  \n} else {\n  \n  tidy_data <- read_csv(str_glue(\"{chart_details$id}.csv.gz\"))\n  \n}\n```\n\n```{r wrangle-data}\n# Add 2022 data manually, from Table F20 of\n# https://www.ons.gov.uk/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesotherrelatedtables\ndata_2022 <- tribble(\n  ~type, ~year, ~percentage,\n  \"Abandoned or burnt-out cars\", 2022, 2.29055253432124,\n  \"High level of perceived anti-social behaviour\", 2022, 8.035801551349,\n  \"Noisy neighbours or loud parties\", 2022, 8.69734313581641,\n  \"People being drunk or rowdy in public places\", 2022, 12.2719758693247,\n  \"People using or dealing drugs\", 2022, 21.6116153941217,\n  \"Rubbish or litter lying around\", 2022, 29.2063861999025,\n  \"Teenagers hanging around on the streets\", 2022, 12.6778098940408, \n  \"Vandalism, graffiti and other deliberate damage to property\", 2022, 13.2306151331332\n) |> \n  mutate(percentage = percentage / 100)\n\nchart_data <- tidy_data |> \n  bind_rows(data_2022) |> \n  mutate(\n    current_rate = last(percentage),\n    year_ending = ymd(str_glue(\"{year}-03-31\")),\n    .by = type\n  ) |> \n  mutate(\n    fill = type == \"High level of perceived anti-social behaviour\",\n    type = fct_reorder(type, current_rate, .desc = TRUE),\n    type = fct_relevel(type, \"High level of perceived anti-social behaviour\"),\n    type = fct_recode(\n      type,\n      \"High level of ASB overall*\" = \"High level of perceived anti-social behaviour\"\n    )\n  )\n  \nlabel_data <- chart_data |> \n  filter(year %in% c(2010, max(chart_data$year))) |> \n  mutate(\n    change = scales::number(\n      (last(percentage) - first(percentage)) / first(percentage), \n      accuracy = 1, \n      scale = 100, \n      suffix = \"%\",\n      style_positive = \"plus\",\n      style_negative = \"minus\"\n    ),\n    .by = type\n  ) |> \n  mutate(\n    colour = current_rate > 0.1,\n    label = case_when(\n      year == max(year) & type == first(type) ~ \n        str_glue(\"**{change}** change, 2010â€“22\"),\n      year == max(year) ~ str_glue(\"**{change}**\"), \n      TRUE ~ NA\n    )\n  ) |> \n  filter(!is.na(label))\n```\n\n```{r}\nchart <- chart_data |> \n  ggplot(aes(x = year_ending, y = percentage)) +\n  geom_area(colour = NA, fill = \"white\") +\n  geom_area(\n    aes(fill = fill),\n    alpha = 0.67, \n    colour = NA\n  ) +\n  geom_line(aes(colour = fill), linewidth = 1) +\n  geom_vline(\n    aes(xintercept = ymd(\"2010-03-31\")), \n    colour = elements$average_line_colour,\n    linetype = elements$average_line_linetype\n  ) +\n  geom_richtext(\n    aes(y = 0, label = label), \n    data = label_data,\n    fill = NA,\n    hjust = 1,\n    label.size = NA,\n    lineheight = elements$label_text_lineheight,\n    size = elements$label_text_size,\n    vjust = 0\n  ) +\n  geom_point(\n    aes(colour = fill),\n    data = label_data,\n    size = 2\n  ) +\n  scale_x_date(\n    expand = expansion(0.025)\n  ) +\n  scale_y_continuous(\n    breaks = c(0, 0.1, 0.2, 0.3),\n    limits = c(0, NA), \n    labels = scales::label_percent(), \n    expand = expansion(c(0, 0.05)),\n    position = \"right\"\n  ) +\n  scale_fill_manual(\n    values = c(\n      `TRUE` = ucl_colours_list[[\"Bright Red\"]], \n      `FALSE` = ucl_colours_list[[\"Bright Blue\"]]\n    ),\n    aesthetics = c(\"colour\", \"fill\")\n  ) +\n  facet_wrap(vars(type), labeller = label_wrap_gen(width = 23), ncol = 4) +\n  labs(\n\t\ttitle = chart_details$title,\n\t\tsubtitle = chart_details$subtitle,\n\t\tcaption = \"\\\\* This is a composite measure based on how big a problem a respondent said they felt each of the specific types of ASB were in their area.\",\n    x = NULL,\n    y = \"percentage of people saying this type of\\nASB is a very/fairly big problem in their area\"\n  ) +\n  theme_cjcharts() +\n  theme(\n    legend.position = \"none\",\n    plot.caption = element_textbox_simple(margin = margin(t = 12)),\n\t\tplot.title = element_textbox_simple(),\n\t\tplot.subtitle = element_textbox_simple(margin = margin(t = 12, b = 6))\n  )\n```\n\n`r chart_details$subtitle`\n\n```{r display-plot, echo=FALSE, include=TRUE, warning=FALSE}\nadd_logo(\n  chart + labs(title = NULL, subtitle = NULL), \n  chart_details$source_title, \n  chart_details$id\n)\n```\n\n[larger image](`r chart_details$id`.png)\n| [annotated R code to produce this chart](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export-chart}\n# Save PNG for social media\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", \n\twidth = 600 / 72, \n\theight = 500 / 72, \n\tunits = \"in\", \n\tbg = \"white\"\n)\n```\n","srcMarkdownNoYaml":"\n\n\n```{r set-knitr-options, include=FALSE}\nknitr::opts_chunk$set(cache = FALSE, include = FALSE, dev = \"ragg_png\")\n```\n\n```{r setup}\n# Custom packages not loaded by helpers.R\nlibrary(readxl)\n\n# Load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n\nchart_details <- list(\n\tid = \"asb-trends\",\n\ttitle = \"Worry about many types of ASB is at its lowest level for 20 years\",\n\tsubtitle = \"The Crime Survey for England and Wales asks people every year if they are worried about different types of anti-social behaviour (ASB) in the area where they live. For many types of ASB, in 2022 the percentage of people saying many types of ASB were a very/fairly big problem in their area was at or near its lowest level since records began in 2002.\",\n\tsource_url = \"https://www.ons.gov.uk/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesannualsupplementarytables\",\n\tsource_title = \"Office for National Statistics\"\n)\n```\n\n```{r load-data}\nif (!file.exists(str_glue(\"{chart_details$id}.csv.gz\"))) {\n  \n  data_file <- tempfile(fileext = \".xlsx\")\n  download.file(\n    url = \"https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesannualsupplementarytables/march2020/annualsupplementarytablesmar201.xlsx\", \n    destfile = data_file\n  )\n  \n  tidy_data <- data_file |> \n    read_excel(\n        sheet = \"Table S34\", \n        skip = 3, \n        na = c(\"\", \":\"), \n        col_types = \"text\"\n    ) |> \n    clean_names() |> \n    slice(3, 7:14) |> \n    select(type = x1, starts_with(\"apr_\")) |> \n    pivot_longer(cols = -type, names_to = \"year\", values_to = \"percentage\") |> \n    mutate(\n      type = str_remove(type, \"[\\\\d\\\\,]+?$\"),\n      year = str_sub(year, start = 15, end = 16), \n      year = str_glue(\"20{year}\"), \n      across(c(year, percentage), parse_number),\n      percentage = percentage / 100\n    ) |> \n    filter(!is.na(type))\n  \n  write_csv(tidy_data, str_glue(\"{chart_details$id}.csv.gz\"))\n  \n} else {\n  \n  tidy_data <- read_csv(str_glue(\"{chart_details$id}.csv.gz\"))\n  \n}\n```\n\n```{r wrangle-data}\n# Add 2022 data manually, from Table F20 of\n# https://www.ons.gov.uk/peoplepopulationandcommunity/crimeandjustice/datasets/crimeinenglandandwalesotherrelatedtables\ndata_2022 <- tribble(\n  ~type, ~year, ~percentage,\n  \"Abandoned or burnt-out cars\", 2022, 2.29055253432124,\n  \"High level of perceived anti-social behaviour\", 2022, 8.035801551349,\n  \"Noisy neighbours or loud parties\", 2022, 8.69734313581641,\n  \"People being drunk or rowdy in public places\", 2022, 12.2719758693247,\n  \"People using or dealing drugs\", 2022, 21.6116153941217,\n  \"Rubbish or litter lying around\", 2022, 29.2063861999025,\n  \"Teenagers hanging around on the streets\", 2022, 12.6778098940408, \n  \"Vandalism, graffiti and other deliberate damage to property\", 2022, 13.2306151331332\n) |> \n  mutate(percentage = percentage / 100)\n\nchart_data <- tidy_data |> \n  bind_rows(data_2022) |> \n  mutate(\n    current_rate = last(percentage),\n    year_ending = ymd(str_glue(\"{year}-03-31\")),\n    .by = type\n  ) |> \n  mutate(\n    fill = type == \"High level of perceived anti-social behaviour\",\n    type = fct_reorder(type, current_rate, .desc = TRUE),\n    type = fct_relevel(type, \"High level of perceived anti-social behaviour\"),\n    type = fct_recode(\n      type,\n      \"High level of ASB overall*\" = \"High level of perceived anti-social behaviour\"\n    )\n  )\n  \nlabel_data <- chart_data |> \n  filter(year %in% c(2010, max(chart_data$year))) |> \n  mutate(\n    change = scales::number(\n      (last(percentage) - first(percentage)) / first(percentage), \n      accuracy = 1, \n      scale = 100, \n      suffix = \"%\",\n      style_positive = \"plus\",\n      style_negative = \"minus\"\n    ),\n    .by = type\n  ) |> \n  mutate(\n    colour = current_rate > 0.1,\n    label = case_when(\n      year == max(year) & type == first(type) ~ \n        str_glue(\"**{change}** change, 2010â€“22\"),\n      year == max(year) ~ str_glue(\"**{change}**\"), \n      TRUE ~ NA\n    )\n  ) |> \n  filter(!is.na(label))\n```\n\n```{r}\nchart <- chart_data |> \n  ggplot(aes(x = year_ending, y = percentage)) +\n  geom_area(colour = NA, fill = \"white\") +\n  geom_area(\n    aes(fill = fill),\n    alpha = 0.67, \n    colour = NA\n  ) +\n  geom_line(aes(colour = fill), linewidth = 1) +\n  geom_vline(\n    aes(xintercept = ymd(\"2010-03-31\")), \n    colour = elements$average_line_colour,\n    linetype = elements$average_line_linetype\n  ) +\n  geom_richtext(\n    aes(y = 0, label = label), \n    data = label_data,\n    fill = NA,\n    hjust = 1,\n    label.size = NA,\n    lineheight = elements$label_text_lineheight,\n    size = elements$label_text_size,\n    vjust = 0\n  ) +\n  geom_point(\n    aes(colour = fill),\n    data = label_data,\n    size = 2\n  ) +\n  scale_x_date(\n    expand = expansion(0.025)\n  ) +\n  scale_y_continuous(\n    breaks = c(0, 0.1, 0.2, 0.3),\n    limits = c(0, NA), \n    labels = scales::label_percent(), \n    expand = expansion(c(0, 0.05)),\n    position = \"right\"\n  ) +\n  scale_fill_manual(\n    values = c(\n      `TRUE` = ucl_colours_list[[\"Bright Red\"]], \n      `FALSE` = ucl_colours_list[[\"Bright Blue\"]]\n    ),\n    aesthetics = c(\"colour\", \"fill\")\n  ) +\n  facet_wrap(vars(type), labeller = label_wrap_gen(width = 23), ncol = 4) +\n  labs(\n\t\ttitle = chart_details$title,\n\t\tsubtitle = chart_details$subtitle,\n\t\tcaption = \"\\\\* This is a composite measure based on how big a problem a respondent said they felt each of the specific types of ASB were in their area.\",\n    x = NULL,\n    y = \"percentage of people saying this type of\\nASB is a very/fairly big problem in their area\"\n  ) +\n  theme_cjcharts() +\n  theme(\n    legend.position = \"none\",\n    plot.caption = element_textbox_simple(margin = margin(t = 12)),\n\t\tplot.title = element_textbox_simple(),\n\t\tplot.subtitle = element_textbox_simple(margin = margin(t = 12, b = 6))\n  )\n```\n\n`r chart_details$subtitle`\n\n```{r display-plot, echo=FALSE, include=TRUE, warning=FALSE}\nadd_logo(\n  chart + labs(title = NULL, subtitle = NULL), \n  chart_details$source_title, \n  chart_details$id\n)\n```\n\n[larger image](`r chart_details$id`.png)\n| [annotated R code to produce this chart](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export-chart}\n# Save PNG for social media\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", \n\twidth = 600 / 72, \n\theight = 500 / 72, \n\tunits = \"in\", \n\tbg = \"white\"\n)\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.551","author":[{"name":"Matt Ashby"},"Matt Ashby"],"theme":["sandstone","../../custom.scss"],"date-format":"D MMM YYYY","title":"Worry about many types of ASB is at its lowest level for 20 years","date":"2023-04-21","slug":"asb-trends","categories":["Crime and justice chart of the week"],"tags":["ASB","trends","CSEW","perceptions"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}