{"title":"Chart: Some police forces are much more likely to prosecute violence","markdown":{"yaml":{"title":"Chart: Some police forces are much more likely to prosecute violence","author":"Matt Ashby","date":"2020-03-02","categories":["Crime and justice chart of the week"],"tags":["criminal justice","police","violence","prosecutions"]},"headingText":"custom packages not loaded by helpers.R","containsRefs":false,"markdown":"\n\n```{r set knitr options, include=FALSE}\nknitr::opts_chunk$set(cache = TRUE, include=FALSE)\n```\n\n```{r set chart parameters}\nchart_details <- list(\n\tid = \"violence-prosecutions\",\n\ttitle = \"Some police forces are much more likely to prosecute violence\",\n\tsubtitle = \"Once police have enough evidence to prosecute an offender, they or prosecutors must decide whether to send the case to court or deal with it informally. For violent crimes, the likelihood of a case going to court varies substantially across police forces, with some prosecuting over 80% of cases and others diverting two thirds to other resolutions such as paying compensation.\",\n\tsource_url = \"https://www.gov.uk/government/statistics/police-recorded-crime-open-data-tables\",\n\tsource_title = \"Home Office, 2019\"\n)\n```\n\n```{r load packages and helper}\nlibrary(\"ggtext\")\nlibrary(\"readODS\")\n\n# load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n```\n\n```{r get and tidy data}\n# get data\nif (!file.exists(paste0(chart_details$id, \"-data.csv.gz\"))) {\n\t\n\t# download data\n\t# data_file <- tempfile(fileext = \".ods\")\n\t# download.file(\"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/859290/prc-outcomes-open-data-mar2019-tables.ods\", destfile = data_file)\n\t\n\t# convert the downloaded ODS file to CSV (e.g. in Excel)\n\t\n\t# load data\n\tfile_data <- read_csv(\n\t\t\"drug-disposals-raw-data.csv.gz\", \n\t\tcol_types = cols(\n\t\t\t`Financial Quarter` = col_double(),\n\t\t\t`Outcome Type` = col_double(),\n\t\t\t`Force outcomes for offences recorded in quarter` = col_double(),\n\t\t\t`Force outcomes recorded in quarter` = col_double(),\n\t\t\t.default = col_character()\n\t\t), \n\t\tna = c(\"N/A - offence code expired\", \"--\")\n\t)\n\t\n\t# tidy data\n\ttidy_data <- file_data %>% \n\t\tclean_names() %>% \n\t\tmutate(offence_code_expired = offence_code_expired == \"x\") %>% \n\t\tfilter(!(force_outcomes_for_offences_recorded_in_quarter == 0 & \n\t\t\t\t\t\t \tforce_outcomes_recorded_in_quarter == 0))\n\t\n\t# save tidy data\n\twrite_csv(tidy_data, paste0(chart_details$id, \"-data.csv.gz\"))\t\n\t\n} else {\n\t\n\t# load tidy data\n\ttidy_data <- read_csv(paste0(chart_details$id, \"-data.csv.gz\"))\n\t\n}\n```\n\n```{r prepare data for chart}\nchart_data <- tidy_data %>% \n\tfilter(\n\t\toffence_group == \"Violence against the person\",\n\t\toutcome_group %in% c(\"Charged/Summonsed\", \"Out-of-court (formal)\", \n\t\t\t\t\t\t\t\t\t\t\t\t \"Out-of-court (informal)\")\n\t) %>% \n\tcount(force_name, outcome_group, \n\t\t\t\twt = force_outcomes_for_offences_recorded_in_quarter) %>% \n\tremove_missing(na.rm = TRUE) %>% \n\tmutate(\n\t\tforce_name = recode(force_name, \"London, City of\" = \"City of London\"),\n\t\toutcome_group = recode_factor(\n\t\t\toutcome_group,\n\t\t\t\"Out-of-court (informal)\" = \"informal community resolution\",\n\t\t\t\"Out-of-court (formal)\" = \"formal caution or fixed penalty notice\",\n\t\t\t\"Charged/Summonsed\" = \"prosecution\"\n\t\t)\n\t)\n\nnational_data <- chart_data %>% \n\tcount(outcome_group, wt = n) %>% \n\tmutate(force_name = \"**England and Wales**\")\n\nforce_order <- chart_data %>% \n\tgroup_by(force_name) %>% \n\tmutate(prop = n / sum(n)) %>% \n\tfilter(outcome_group == \"prosecution\") %>% \n\tarrange(desc(prop)) %>% \n\tpull(\"force_name\")\n\nchart_data <- chart_data %>% \n\trbind(national_data) %>% \n\tmutate(force_name = factor(force_name, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t levels = c(\"**England and Wales**\", force_order)))\n```\n\n```{r build plot}\nchart <- ggplot(chart_data, aes(n, force_name, fill = outcome_group)) +\n\tgeom_col(position = position_fill(), width = 0.8) +\n\tgeom_vline(xintercept = seq(0, 1, by = 0.1), colour = \"white\", alpha = 0.25) +\n\tscale_x_continuous(n.breaks = 10, \n\t\t\t\t\t\t\t\t\t\t labels = scales::percent_format(accuracy = 1), \n\t\t\t\t\t\t\t\t\t\t expand = expansion(mult = c(0, 0.02))) +\n\tscale_fill_manual(\n\t\tvalues = unname(ucl_colours_list[c(\"Bright Blue\", \"Light Purple\", \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \"Yellow\")])\n\t) +\n\tlabs(\n\t\ttitle = chart_details$title,\n\t\tsubtitle = format_subtitle(chart_details$subtitle),\n\t\tlegend = NULL,\n\t\tx = \"proportion of violence cases for which prosecution was possible\",\n\t\ty = NULL,\n\t\tfill = NULL\n\t) +\n\ttheme_cjcharts() +\n\ttheme(\n\t\taxis.text.y = element_markdown(size = 7),\n\t\taxis.ticks.y = element_blank(),\n\t\tlegend.box.margin = margin(0, 0, 0, 0),\n\t\tlegend.margin = margin(0, 0, 0, 0),\n\t\tpanel.grid = element_blank(),\n\t\tplot.title.position = \"plot\"\n\t)\n```\n\n`r chart_details$subtitle`\n\n```{r display plot, echo=FALSE, include=TRUE}\nadd_logo(chart + labs(title = NULL, subtitle = NULL), \n\t\t\t\t chart_details$source_title, chart_details$id)\n```\n\n[larger image](../`r chart_details$id`.png) | [annotated R code to produce this chart](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export chart}\n# save PNG for social media\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", width = 600 / 72, height = 500 / 72, units = \"in\"\n)\n```\n\n","srcMarkdownNoYaml":"\n\n```{r set knitr options, include=FALSE}\nknitr::opts_chunk$set(cache = TRUE, include=FALSE)\n```\n\n```{r set chart parameters}\nchart_details <- list(\n\tid = \"violence-prosecutions\",\n\ttitle = \"Some police forces are much more likely to prosecute violence\",\n\tsubtitle = \"Once police have enough evidence to prosecute an offender, they or prosecutors must decide whether to send the case to court or deal with it informally. For violent crimes, the likelihood of a case going to court varies substantially across police forces, with some prosecuting over 80% of cases and others diverting two thirds to other resolutions such as paying compensation.\",\n\tsource_url = \"https://www.gov.uk/government/statistics/police-recorded-crime-open-data-tables\",\n\tsource_title = \"Home Office, 2019\"\n)\n```\n\n```{r load packages and helper}\n# custom packages not loaded by helpers.R\nlibrary(\"ggtext\")\nlibrary(\"readODS\")\n\n# load this after loading custom packages\nsource(here::here(\"helpers.R\"))\n```\n\n```{r get and tidy data}\n# get data\nif (!file.exists(paste0(chart_details$id, \"-data.csv.gz\"))) {\n\t\n\t# download data\n\t# data_file <- tempfile(fileext = \".ods\")\n\t# download.file(\"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/859290/prc-outcomes-open-data-mar2019-tables.ods\", destfile = data_file)\n\t\n\t# convert the downloaded ODS file to CSV (e.g. in Excel)\n\t\n\t# load data\n\tfile_data <- read_csv(\n\t\t\"drug-disposals-raw-data.csv.gz\", \n\t\tcol_types = cols(\n\t\t\t`Financial Quarter` = col_double(),\n\t\t\t`Outcome Type` = col_double(),\n\t\t\t`Force outcomes for offences recorded in quarter` = col_double(),\n\t\t\t`Force outcomes recorded in quarter` = col_double(),\n\t\t\t.default = col_character()\n\t\t), \n\t\tna = c(\"N/A - offence code expired\", \"--\")\n\t)\n\t\n\t# tidy data\n\ttidy_data <- file_data %>% \n\t\tclean_names() %>% \n\t\tmutate(offence_code_expired = offence_code_expired == \"x\") %>% \n\t\tfilter(!(force_outcomes_for_offences_recorded_in_quarter == 0 & \n\t\t\t\t\t\t \tforce_outcomes_recorded_in_quarter == 0))\n\t\n\t# save tidy data\n\twrite_csv(tidy_data, paste0(chart_details$id, \"-data.csv.gz\"))\t\n\t\n} else {\n\t\n\t# load tidy data\n\ttidy_data <- read_csv(paste0(chart_details$id, \"-data.csv.gz\"))\n\t\n}\n```\n\n```{r prepare data for chart}\nchart_data <- tidy_data %>% \n\tfilter(\n\t\toffence_group == \"Violence against the person\",\n\t\toutcome_group %in% c(\"Charged/Summonsed\", \"Out-of-court (formal)\", \n\t\t\t\t\t\t\t\t\t\t\t\t \"Out-of-court (informal)\")\n\t) %>% \n\tcount(force_name, outcome_group, \n\t\t\t\twt = force_outcomes_for_offences_recorded_in_quarter) %>% \n\tremove_missing(na.rm = TRUE) %>% \n\tmutate(\n\t\tforce_name = recode(force_name, \"London, City of\" = \"City of London\"),\n\t\toutcome_group = recode_factor(\n\t\t\toutcome_group,\n\t\t\t\"Out-of-court (informal)\" = \"informal community resolution\",\n\t\t\t\"Out-of-court (formal)\" = \"formal caution or fixed penalty notice\",\n\t\t\t\"Charged/Summonsed\" = \"prosecution\"\n\t\t)\n\t)\n\nnational_data <- chart_data %>% \n\tcount(outcome_group, wt = n) %>% \n\tmutate(force_name = \"**England and Wales**\")\n\nforce_order <- chart_data %>% \n\tgroup_by(force_name) %>% \n\tmutate(prop = n / sum(n)) %>% \n\tfilter(outcome_group == \"prosecution\") %>% \n\tarrange(desc(prop)) %>% \n\tpull(\"force_name\")\n\nchart_data <- chart_data %>% \n\trbind(national_data) %>% \n\tmutate(force_name = factor(force_name, \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t levels = c(\"**England and Wales**\", force_order)))\n```\n\n```{r build plot}\nchart <- ggplot(chart_data, aes(n, force_name, fill = outcome_group)) +\n\tgeom_col(position = position_fill(), width = 0.8) +\n\tgeom_vline(xintercept = seq(0, 1, by = 0.1), colour = \"white\", alpha = 0.25) +\n\tscale_x_continuous(n.breaks = 10, \n\t\t\t\t\t\t\t\t\t\t labels = scales::percent_format(accuracy = 1), \n\t\t\t\t\t\t\t\t\t\t expand = expansion(mult = c(0, 0.02))) +\n\tscale_fill_manual(\n\t\tvalues = unname(ucl_colours_list[c(\"Bright Blue\", \"Light Purple\", \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \"Yellow\")])\n\t) +\n\tlabs(\n\t\ttitle = chart_details$title,\n\t\tsubtitle = format_subtitle(chart_details$subtitle),\n\t\tlegend = NULL,\n\t\tx = \"proportion of violence cases for which prosecution was possible\",\n\t\ty = NULL,\n\t\tfill = NULL\n\t) +\n\ttheme_cjcharts() +\n\ttheme(\n\t\taxis.text.y = element_markdown(size = 7),\n\t\taxis.ticks.y = element_blank(),\n\t\tlegend.box.margin = margin(0, 0, 0, 0),\n\t\tlegend.margin = margin(0, 0, 0, 0),\n\t\tpanel.grid = element_blank(),\n\t\tplot.title.position = \"plot\"\n\t)\n```\n\n`r chart_details$subtitle`\n\n```{r display plot, echo=FALSE, include=TRUE}\nadd_logo(chart + labs(title = NULL, subtitle = NULL), \n\t\t\t\t chart_details$source_title, chart_details$id)\n```\n\n[larger image](../`r chart_details$id`.png) | [annotated R code to produce this chart](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)\n\nData source: [`r chart_details$source_title`](`r chart_details$source_url`)\n\n```{r export chart}\n# save PNG for social media\nggsave(\n\tfilename = paste0(chart_details$id, \".png\"), \n\tplot = add_logo(chart, chart_details$source_title, chart_details$id), \n\tdevice = \"png\", width = 600 / 72, height = 500 / 72, units = \"in\"\n)\n```\n\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.40","author":[{"name":"Matt Ashby"},"Matt Ashby"],"theme":["sandstone","../../custom.scss"],"date-format":"D MMM YYYY","title":"Chart: Some police forces are much more likely to prosecute violence","date":"2020-03-02","categories":["Crime and justice chart of the week"],"tags":["criminal justice","police","violence","prosecutions"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}